import{l as p,s as Da,f as Ce,u as xe,a as Fe,t as ka,B as ie,j as e,c as Ze,v as rt,w as It,x as ms,y as Ma,z as La,b as Ie,g as Rt,A as Ds,C as $a,r as Pe,D as Ea,E as $s,F as za,k as Oe,T as ne,M as Ps,G as we,n as be,H as ot,J as nt,U as js,K as yt,N as Aa,p as B,R as Na,P as Je,O as ys,i as Ia,Q as Ra,m as Pa,o as Ta,L as bt,h as Fa}from"./index-ChNr1GaT.js";import{d as L,G as Ye,D as jt,I as Es,T as zs,a as st,M as Xs,b as Pt,c as Oa,e as Va,f as Tt,g as Ya,q as cs,h as ws,i as Ha,j as ss,C as rs,A as Ba}from"./AnalisisLecturasPanel-D4X8V50C.js";import{b as qa,e as Ga}from"./casosApi-CONg4Tmm.js";import{g as Wa,A as wt,d as Ua}from"./archivosApi-Ba9CRSX7.js";import{a as ds,b as Ae,A as ns,I as Ka}from"./api-B9d806Z_.js";import{M as Ft,T as Ot,a as Vt,P as Yt,I as As,L as Za,u as Xa,b as Ja}from"./TileLayer-DBmxVQ6v.js";import{L as Ke}from"./xlsx-ULsuK5bU.js";import{T as lt}from"./Textarea-ELLLunE-.js";import{c as Cs,_ as os,T as ls,N as Ns}from"./lodash-CBZiuDCF.js";import{C as Qa,b as Ht,c as ks,A as Le,I as We,P as us,d as er,u as Bt,S as Te,T as Ue,a as $e}from"./Title-DqhdHHkm.js";import{u as sr,I as Ss}from"./use-form-hDBYc0fM.js";import{a as Js,I as tr}from"./IconUpload-DHJEEtc7.js";import{C as ar}from"./Container-BvsZKyAu.js";import"./get-base-value-JqT_q0U7.js";function qt(t){return{x:Cs(t.x,0,1),y:Cs(t.y,0,1)}}function Gt(t,s,a="ltr"){const r=p.useRef(null),o=p.useRef(!1),i=p.useRef(!1),l=p.useRef(0),[u,f]=p.useState(!1);return p.useEffect(()=>{o.current=!0},[]),p.useEffect(()=>{const n=r.current,m=({x:b,y:M})=>{cancelAnimationFrame(l.current),l.current=requestAnimationFrame(()=>{if(o.current&&n){n.style.userSelect="none";const $=n.getBoundingClientRect();if($.width&&$.height){const w=Cs((b-$.left)/$.width,0,1);t({x:a==="ltr"?w:1-w,y:Cs((M-$.top)/$.height,0,1)})}}})},v=()=>{document.addEventListener("mousemove",j),document.addEventListener("mouseup",h),document.addEventListener("touchmove",S),document.addEventListener("touchend",h)},y=()=>{document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",h),document.removeEventListener("touchmove",S),document.removeEventListener("touchend",h)},x=()=>{!i.current&&o.current&&(i.current=!0,typeof(s==null?void 0:s.onScrubStart)=="function"&&s.onScrubStart(),f(!0),v())},h=()=>{i.current&&o.current&&(i.current=!1,f(!1),y(),setTimeout(()=>{typeof(s==null?void 0:s.onScrubEnd)=="function"&&s.onScrubEnd()},0))},c=b=>{x(),b.preventDefault(),j(b)},j=b=>m({x:b.clientX,y:b.clientY}),g=b=>{b.cancelable&&b.preventDefault(),x(),S(b)},S=b=>{b.cancelable&&b.preventDefault(),m({x:b.changedTouches[0].clientX,y:b.changedTouches[0].clientY})};return n==null||n.addEventListener("mousedown",c),n==null||n.addEventListener("touchstart",g,{passive:!1}),()=>{n&&(n.removeEventListener("mousedown",c),n.removeEventListener("touchstart",g))}},[a,t]),{ref:r,active:u}}function rr(){return navigator.userAgent.includes("OPR")}function or(){const[t,s]=p.useState(!1);Da(()=>{s(typeof window<"u"&&!rr()&&"EyeDropper"in window)},[]);const a=p.useCallback((r={})=>t?new window.EyeDropper().open(r):Promise.resolve(void 0),[t]);return{supported:t,open:a}}var Wt={root:"m_8b3717df",breadcrumb:"m_f678d540",separator:"m_3b8f2208"};const nr={separator:"/"},lr=Ze((t,{separatorMargin:s})=>({root:{"--bc-separator-margin":rt(s)}})),it=Ce((t,s)=>{const a=xe("Breadcrumbs",nr,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,children:n,separator:m,separatorMargin:v,...y}=a,x=Fe({name:"Breadcrumbs",classes:Wt,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,varsResolver:lr}),h=p.Children.toArray(n).reduce((c,j,g,S)=>{var M;const b=ka(j)?p.cloneElement(j,{...x("breadcrumb",{className:(M=j.props)==null?void 0:M.className}),key:g}):p.createElement("div",{...x("breadcrumb"),key:g},j);return c.push(b),g!==S.length-1&&c.push(p.createElement(ie,{...x("separator"),key:`separator-${g}`},m)),c},[]);return e.jsx(ie,{ref:s,...x("root"),...y,children:h})});it.classes=Wt;it.displayName="@mantine/core/Breadcrumbs";const[ir,cr]=It(),dr={};function Ut(t){const{value:s,defaultValue:a,onChange:r,multiple:o,children:i}=xe("ChipGroup",dr,t),[l,u]=ms({value:s,defaultValue:a,finalValue:o?[]:null,onChange:r}),f=m=>Array.isArray(l)?l.includes(m):m===l,n=m=>{const v=m.currentTarget.value;Array.isArray(l)?u(l.includes(v)?l.filter(y=>y!==v):[...l,v]):u(v)};return e.jsx(ir,{value:{isChipSelected:f,onChange:n,multiple:o},children:i})}Ut.displayName="@mantine/core/ChipGroup";var Kt={root:"m_f59ffda3",label:"m_be049a53","label--outline":"m_3904c1af","label--filled":"m_fa109255","label--light":"m_f7e165c3",iconWrapper:"m_9ac86df9",checkIcon:"m_d6d72580",input:"m_bde07329"};const ur={type:"checkbox"},hr=Ze((t,{size:s,radius:a,variant:r,color:o,autoContrast:i})=>{const l=t.variantColorResolver({color:o||t.primaryColor,theme:t,variant:r||"filled",autoContrast:i});return{root:{"--chip-fz":Ds(s),"--chip-size":Ie(s,"chip-size"),"--chip-radius":a===void 0?void 0:Rt(a),"--chip-checked-padding":Ie(s,"chip-checked-padding"),"--chip-padding":Ie(s,"chip-padding"),"--chip-icon-size":Ie(s,"chip-icon-size"),"--chip-bg":o||r?l.background:void 0,"--chip-hover":o||r?l.hover:void 0,"--chip-color":o||r?l.color:void 0,"--chip-bd":o||r?l.border:void 0,"--chip-spacing":Ie(s,"chip-spacing")}}}),_s=Ce((t,s)=>{const a=xe("Chip",ur,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,id:n,checked:m,defaultChecked:v,onChange:y,value:x,wrapperProps:h,type:c,disabled:j,children:g,size:S,variant:b,icon:M,rootRef:$,autoContrast:w,mod:D,...E}=a,k=Fe({name:"Chip",classes:Kt,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,varsResolver:hr}),F=cr(),T=Ma(n),{styleProps:H,rest:O}=La(E),[ee,X]=ms({value:m,defaultValue:v,finalValue:!1,onChange:y}),W=F?{checked:F.isChipSelected(x),onChange:q=>{F.onChange(q),y==null||y(q.currentTarget.checked)},type:F.multiple?"checkbox":"radio"}:{},N=W.checked||ee;return e.jsxs(ie,{size:S,variant:b,ref:$,mod:D,...k("root"),...H,...h,children:[e.jsx("input",{type:c,...k("input"),checked:N,onChange:q=>X(q.currentTarget.checked),id:T,disabled:j,ref:s,value:x,...W,...O}),e.jsxs("label",{htmlFor:T,"data-checked":N||void 0,"data-disabled":j||void 0,...k("label",{variant:b||"filled"}),children:[N&&e.jsx("span",{...k("iconWrapper"),children:M||e.jsx(Qa,{...k("checkIcon")})}),e.jsx("span",{children:g})]})]})});_s.classes=Kt;_s.displayName="@mantine/core/Chip";_s.Group=Ut;var Zt={root:"m_de3d2490",colorOverlay:"m_862f3d1b",shadowOverlay:"m_98ae7f22",alphaOverlay:"m_95709ac0",childrenOverlay:"m_93e74e3"};const Ct={withShadow:!0},mr=Ze((t,{radius:s,size:a})=>({root:{"--cs-radius":s===void 0?void 0:Rt(s),"--cs-size":Pe(a)}})),Ms=$a((t,s)=>{const a=xe("ColorSwatch",Ct,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,color:n,size:m,radius:v,withShadow:y,children:x,variant:h,...c}=xe("ColorSwatch",Ct,a),j=Fe({name:"ColorSwatch",props:a,classes:Zt,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,varsResolver:mr});return e.jsxs(ie,{ref:s,variant:h,size:m,...j("root",{focusable:!0}),...c,children:[e.jsx("span",{...j("alphaOverlay")}),y&&e.jsx("span",{...j("shadowOverlay")}),e.jsx("span",{...j("colorOverlay",{style:{backgroundColor:n}})}),e.jsx("span",{...j("childrenOverlay"),children:x})]})});Ms.classes=Zt;Ms.displayName="@mantine/core/ColorSwatch";const[pr,ct]=It(null),dt=p.forwardRef(({position:t,...s},a)=>e.jsx(ie,{ref:a,__vars:{"--thumb-y-offset":`${t.y*100}%`,"--thumb-x-offset":`${t.x*100}%`},...s}));dt.displayName="@mantine/core/ColorPickerThumb";var ut={wrapper:"m_fee9c77",preview:"m_9dddfbac",body:"m_bffecc3e",sliders:"m_3283bb96",thumb:"m_40d572ba",swatch:"m_d8ee6fd8",swatches:"m_5711e686",saturation:"m_202a296e",saturationOverlay:"m_11b3db02",slider:"m_d856d47d",sliderOverlay:"m_8f327113"};const fr={},ht=Ce((t,s)=>{var q;const a=xe("ColorSlider",fr,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,onChange:n,onChangeEnd:m,maxValue:v,round:y,size:x="md",focusable:h=!0,value:c,overlays:j,thumbColor:g="transparent",onScrubStart:S,onScrubEnd:b,__staticSelector:M="ColorPicker",...$}=a,w=Fe({name:M,classes:ut,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u}),E=((q=ct())==null?void 0:q.getStyles)||w,k=Ea(),[F,T]=p.useState({y:0,x:c/v}),H=p.useRef(F),O=_=>y?Math.round(_*v):_*v,{ref:ee}=Gt(({x:_,y:U})=>{H.current={x:_,y:U},n==null||n(O(_))},{onScrubEnd:()=>{const{x:_}=H.current;m==null||m(O(_)),b==null||b()},onScrubStart:S});$s(()=>{T({y:0,x:c/v})},[c]);const X=(_,U)=>{_.preventDefault();const A=qt(U);n==null||n(O(A.x)),m==null||m(O(A.x))},W=_=>{switch(_.key){case"ArrowRight":{X(_,{x:F.x+.05,y:F.y});break}case"ArrowLeft":{X(_,{x:F.x-.05,y:F.y});break}}},N=j.map((_,U)=>p.createElement("div",{...E("sliderOverlay"),style:_,key:U}));return e.jsxs(ie,{...$,ref:za(ee,s),...E("slider"),role:"slider","aria-valuenow":c,"aria-valuemax":v,"aria-valuemin":0,tabIndex:h?0:-1,onKeyDown:W,"data-focus-ring":k.focusRing,__vars:{"--cp-thumb-size":`var(--cp-thumb-size-${x})`},children:[N,e.jsx(dt,{position:F,...E("thumb",{style:{top:Pe(1),background:g}})})]})});ht.displayName="@mantine/core/ColorSlider";function Be(t,s=0,a=10**s){return Math.round(a*t)/a}function gr({h:t,s,l:a,a:r}){const o=s*((a<50?a:100-a)/100);return{h:t,s:o>0?2*o/(a+o)*100:0,v:a+o,a:r}}const vr={grad:360/400,turn:360,rad:360/(Math.PI*2)};function xr(t,s="deg"){return Number(t)*(vr[s]||1)}const yr=/hsla?\(?\s*(-?\d*\.?\d+)(deg|rad|grad|turn)?[,\s]+(-?\d*\.?\d+)%?[,\s]+(-?\d*\.?\d+)%?,?\s*[/\s]*(-?\d*\.?\d+)?(%)?\s*\)?/i;function St(t){const s=yr.exec(t);return s?gr({h:xr(s[1],s[2]),s:Number(s[3]),l:Number(s[4]),a:s[5]===void 0?1:Number(s[5])/(s[6]?100:1)}):{h:0,s:0,v:0,a:1}}function tt({r:t,g:s,b:a,a:r}){const o=Math.max(t,s,a),i=o-Math.min(t,s,a),l=i?o===t?(s-a)/i:o===s?2+(a-t)/i:4+(t-s)/i:0;return{h:Be(60*(l<0?l+6:l),3),s:Be(o?i/o*100:0,3),v:Be(o/255*100,3),a:r}}function at(t){const s=t[0]==="#"?t.slice(1):t;return s.length===3?tt({r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:1}):tt({r:parseInt(s.slice(0,2),16),g:parseInt(s.slice(2,4),16),b:parseInt(s.slice(4,6),16),a:1})}function br(t){const s=t[0]==="#"?t.slice(1):t,a=l=>Be(parseInt(l,16)/255,3);if(s.length===4){const l=s.slice(0,3),u=a(s[3]+s[3]);return{...at(l),a:u}}const r=s.slice(0,6),o=a(s.slice(6,8));return{...at(r),a:o}}const jr=/rgba?\(?\s*(-?\d*\.?\d+)(%)?[,\s]+(-?\d*\.?\d+)(%)?[,\s]+(-?\d*\.?\d+)(%)?,?\s*[/\s]*(-?\d*\.?\d+)?(%)?\s*\)?/i;function _t(t){const s=jr.exec(t);return s?tt({r:Number(s[1])/(s[2]?100/255:1),g:Number(s[3])/(s[4]?100/255:1),b:Number(s[5])/(s[6]?100/255:1),a:s[7]===void 0?1:Number(s[7])/(s[8]?100:1)}):{h:0,s:0,v:0,a:1}}const Xt={hex:/^#?([0-9A-F]{3}){1,2}$/i,hexa:/^#?([0-9A-F]{4}){1,2}$/i,rgb:/^rgb\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/i,rgba:/^rgba\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/i,hsl:/hsl\(\s*(\d+)\s*,\s*(\d+(?:\.\d+)?%)\s*,\s*(\d+(?:\.\d+)?%)\)/i,hsla:/^hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*(\d*(?:\.\d+)?)\)$/i},wr={hex:at,hexa:br,rgb:_t,rgba:_t,hsl:St,hsla:St};function bs(t){for(const[,s]of Object.entries(Xt))if(s.test(t))return!0;return!1}function is(t){if(typeof t!="string")return{h:0,s:0,v:0,a:1};if(t==="transparent")return{h:0,s:0,v:0,a:0};const s=t.trim();for(const[a,r]of Object.entries(Xt))if(r.test(s))return wr[a](s);return{h:0,s:0,v:0,a:1}}const Cr={},Jt=p.forwardRef((t,s)=>{const{value:a,onChange:r,onChangeEnd:o,color:i,...l}=xe("AlphaSlider",Cr,t);return e.jsx(ht,{...l,ref:s,value:a,onChange:u=>r==null?void 0:r(Be(u,2)),onChangeEnd:u=>o==null?void 0:o(Be(u,2)),maxValue:1,round:!1,"data-alpha":!0,overlays:[{backgroundImage:"linear-gradient(45deg, var(--slider-checkers) 25%, transparent 25%), linear-gradient(-45deg, var(--slider-checkers) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, var(--slider-checkers) 75%), linear-gradient(-45deg, var(--mantine-color-body) 75%, var(--slider-checkers) 75%)",backgroundSize:`${Pe(8)} ${Pe(8)}`,backgroundPosition:`0 0, 0 ${Pe(4)}, ${Pe(4)} ${Pe(-4)}, ${Pe(-4)} 0`},{backgroundImage:`linear-gradient(90deg, transparent, ${i})`},{boxShadow:`rgba(0, 0, 0, .1) 0 0 0 ${Pe(1)} inset, rgb(0, 0, 0, .15) 0 0 ${Pe(4)} inset`}]})});Jt.displayName="@mantine/core/AlphaSlider";function Qt({h:t,s,v:a,a:r}){const o=t/360*6,i=s/100,l=a/100,u=Math.floor(o),f=l*(1-i),n=l*(1-(o-u)*i),m=l*(1-(1-o+u)*i),v=u%6;return{r:Be([l,n,f,f,m,l][v]*255),g:Be([m,l,l,n,f,f][v]*255),b:Be([f,f,m,l,l,n][v]*255),a:Be(r,2)}}function Dt(t,s){const{r:a,g:r,b:o,a:i}=Qt(t);return s?`rgba(${a}, ${r}, ${o}, ${Be(i,2)})`:`rgb(${a}, ${r}, ${o})`}function kt({h:t,s,v:a,a:r},o){const i=(200-s)*a/100,l={h:Math.round(t),s:Math.round(i>0&&i<200?s*a/100/(i<=100?i:200-i)*100:0),l:Math.round(i/2)};return o?`hsla(${l.h}, ${l.s}%, ${l.l}%, ${Be(r,2)})`:`hsl(${l.h}, ${l.s}%, ${l.l}%)`}function Ls(t){const s=t.toString(16);return s.length<2?`0${s}`:s}function ea(t){const{r:s,g:a,b:r}=Qt(t);return`#${Ls(s)}${Ls(a)}${Ls(r)}`}function Sr(t){const s=Math.round(t.a*255);return`${ea(t)}${Ls(s)}`}const Qs={hex:ea,hexa:t=>Sr(t),rgb:t=>Dt(t,!1),rgba:t=>Dt(t,!0),hsl:t=>kt(t,!1),hsla:t=>kt(t,!0)};function qe(t,s){return s?t in Qs?Qs[t](s):Qs.hex(s):"#000000"}const sa=p.forwardRef((t,s)=>{const{value:a,onChange:r,onChangeEnd:o,color:i,...l}=xe("HueSlider",{},t);return e.jsx(ht,{...l,ref:s,value:a,onChange:r,onChangeEnd:o,maxValue:360,thumbColor:`hsl(${a}, 100%, 50%)`,round:!0,"data-hue":!0,overlays:[{backgroundImage:"linear-gradient(to right,hsl(0,100%,50%),hsl(60,100%,50%),hsl(120,100%,50%),hsl(170,100%,50%),hsl(240,100%,50%),hsl(300,100%,50%),hsl(360,100%,50%))"},{boxShadow:`rgba(0, 0, 0, .1) 0 0 0 ${Pe(1)} inset, rgb(0, 0, 0, .15) 0 0 ${Pe(4)} inset`}]})});sa.displayName="@mantine/core/HueSlider";function ta({className:t,onChange:s,onChangeEnd:a,value:r,saturationLabel:o,focusable:i=!0,size:l,color:u,onScrubStart:f,onScrubEnd:n,...m}){const{getStyles:v}=ct(),[y,x]=p.useState({x:r.s/100,y:1-r.v/100}),h=p.useRef(y),{ref:c}=Gt(({x:S,y:b})=>{h.current={x:S,y:b},s({s:Math.round(S*100),v:Math.round((1-b)*100)})},{onScrubEnd:()=>{const{x:S,y:b}=h.current;a({s:Math.round(S*100),v:Math.round((1-b)*100)}),n==null||n()},onScrubStart:f});p.useEffect(()=>{x({x:r.s/100,y:1-r.v/100})},[r.s,r.v]);const j=(S,b)=>{S.preventDefault();const M=qt(b);s({s:Math.round(M.x*100),v:Math.round((1-M.y)*100)}),a({s:Math.round(M.x*100),v:Math.round((1-M.y)*100)})},g=S=>{switch(S.key){case"ArrowUp":{j(S,{y:y.y-.05,x:y.x});break}case"ArrowDown":{j(S,{y:y.y+.05,x:y.x});break}case"ArrowRight":{j(S,{x:y.x+.05,y:y.y});break}case"ArrowLeft":{j(S,{x:y.x-.05,y:y.y});break}}};return e.jsxs(ie,{...v("saturation"),ref:c,...m,role:"slider","aria-label":o,"aria-valuenow":y.x,"aria-valuetext":qe("rgba",r),tabIndex:i?0:-1,onKeyDown:g,children:[e.jsx("div",{...v("saturationOverlay",{style:{backgroundColor:`hsl(${r.h}, 100%, 50%)`}})}),e.jsx("div",{...v("saturationOverlay",{style:{backgroundImage:"linear-gradient(90deg, #fff, transparent)"}})}),e.jsx("div",{...v("saturationOverlay",{style:{backgroundImage:"linear-gradient(0deg, #000, transparent)"}})}),e.jsx(dt,{position:y,...v("thumb",{style:{backgroundColor:u}})})]})}ta.displayName="@mantine/core/Saturation";const aa=p.forwardRef(({className:t,datatype:s,setValue:a,onChangeEnd:r,size:o,focusable:i,data:l,swatchesPerRow:u,...f},n)=>{const m=ct(),v=l.map((y,x)=>p.createElement(Ms,{...m.getStyles("swatch"),unstyled:m.unstyled,component:"button",type:"button",color:y,key:x,radius:"sm",onClick:()=>{a(y),r==null||r(y)},"aria-label":y,tabIndex:i?0:-1,"data-swatch":!0}));return e.jsx(ie,{...m.getStyles("swatches"),ref:n,...f,children:v})});aa.displayName="@mantine/core/Swatches";const _r={swatchesPerRow:7,withPicker:!0,focusable:!0,size:"md",__staticSelector:"ColorPicker"},Dr=Ze((t,{size:s,swatchesPerRow:a})=>({wrapper:{"--cp-preview-size":Ie(s,"cp-preview-size"),"--cp-width":Ie(s,"cp-width"),"--cp-body-spacing":rt(s),"--cp-swatch-size":`${100/a}%`,"--cp-thumb-size":Ie(s,"cp-thumb-size"),"--cp-saturation-height":Ie(s,"cp-saturation-height")}})),mt=Ce((t,s)=>{const a=xe("ColorPicker",_r,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,format:n,value:m,defaultValue:v,onChange:y,onChangeEnd:x,withPicker:h,size:c,saturationLabel:j,hueLabel:g,alphaLabel:S,focusable:b,swatches:M,swatchesPerRow:$,fullWidth:w,onColorSwatchClick:D,__staticSelector:E,mod:k,...F}=a,T=Fe({name:E,props:a,classes:ut,className:o,style:i,classNames:r,styles:l,unstyled:u,rootSelector:"wrapper",vars:f,varsResolver:Dr}),H=p.useRef(n),O=p.useRef(""),ee=p.useRef(-1),X=p.useRef(!1),W=n==="hexa"||n==="rgba"||n==="hsla",[N,q,_]=ms({value:m,defaultValue:v,finalValue:"#FFFFFF",onChange:y}),[U,A]=p.useState(is(N)),V=()=>{window.clearTimeout(ee.current),X.current=!0},C=()=>{window.clearTimeout(ee.current),ee.current=window.setTimeout(()=>{X.current=!1},200)},I=se=>{A(oe=>{const ue={...oe,...se};return O.current=qe(H.current,ue),ue}),q(O.current)};return $s(()=>{bs(m)&&!X.current&&A(is(m))},[m]),$s(()=>{H.current=n,q(qe(n,U))},[n]),e.jsx(pr,{value:{getStyles:T,unstyled:u},children:e.jsxs(ie,{ref:s,...T("wrapper"),size:c,mod:[{"full-width":w},k],...F,children:[h&&e.jsxs(e.Fragment,{children:[e.jsx(ta,{value:U,onChange:I,onChangeEnd:({s:se,v:oe})=>x==null?void 0:x(qe(H.current,{...U,s:se,v:oe})),color:N,size:c,focusable:b,saturationLabel:j,onScrubStart:V,onScrubEnd:C}),e.jsxs("div",{...T("body"),children:[e.jsxs("div",{...T("sliders"),children:[e.jsx(sa,{value:U.h,onChange:se=>I({h:se}),onChangeEnd:se=>x==null?void 0:x(qe(H.current,{...U,h:se})),size:c,focusable:b,"aria-label":g,onScrubStart:V,onScrubEnd:C}),W&&e.jsx(Jt,{value:U.a,onChange:se=>I({a:se}),onChangeEnd:se=>{x==null||x(qe(H.current,{...U,a:se}))},size:c,color:qe("hex",U),focusable:b,"aria-label":S,onScrubStart:V,onScrubEnd:C})]}),W&&e.jsx(Ms,{color:N,radius:"sm",size:"var(--cp-preview-size)",...T("preview")})]})]}),Array.isArray(M)&&e.jsx(aa,{data:M,swatchesPerRow:$,focusable:b,setValue:q,onChangeEnd:se=>{const oe=qe(n,is(se));D==null||D(oe),x==null||x(oe),_||A(is(se))}})]})})});mt.classes=ut;mt.displayName="@mantine/core/ColorPicker";function kr({style:t,...s}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:{width:"var(--ci-eye-dropper-icon-size)",height:"var(--ci-eye-dropper-icon-size)",...t},viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M11 7l6 6"}),e.jsx("path",{d:"M4 16l11.7 -11.7a1 1 0 0 1 1.4 0l2.6 2.6a1 1 0 0 1 0 1.4l-11.7 11.7h-4v-4z"})]})}var Mt={eyeDropperIcon:"m_b077c2bc",colorPreview:"m_c5ccdcab",dropdown:"m_5ece2cd7"};const Lt={format:"hex",fixOnBlur:!0,withPreview:!0,swatchesPerRow:7,withPicker:!0,popoverProps:{transitionProps:{transition:"fade",duration:0}},withEyeDropper:!0},Mr=Ze((t,{size:s})=>({eyeDropperIcon:{"--ci-eye-dropper-icon-size":Ie(s,"ci-eye-dropper-icon-size")},colorPreview:{"--ci-preview-size":Ie(s,"ci-preview-size")}})),pt=Ce((t,s)=>{const a=xe("ColorInput",Lt,t),{classNames:r,styles:o,unstyled:i,disallowInput:l,fixOnBlur:u,popoverProps:f,withPreview:n,withEyeDropper:m,eyeDropperIcon:v,closeOnColorSwatchClick:y,eyeDropperButtonProps:x,value:h,defaultValue:c,onChange:j,onChangeEnd:g,onClick:S,onFocus:b,onBlur:M,inputProps:$,format:w,wrapperProps:D,readOnly:E,withPicker:k,swatches:F,disabled:T,leftSection:H,rightSection:O,swatchesPerRow:ee,...X}=Ht("ColorInput",Lt,t),W=Fe({name:"ColorInput",props:a,classes:Mt,classNames:r,styles:o,unstyled:i,rootSelector:"wrapper",vars:a.vars,varsResolver:Mr}),{resolvedClassNames:N,resolvedStyles:q}=ks({classNames:r,styles:o,props:a}),[_,U]=p.useState(!1),[A,V]=p.useState(""),[C,I]=ms({value:h,defaultValue:c,finalValue:"",onChange:j}),{supported:se,open:oe}=or(),ue=e.jsx(Le,{...x,...W("eyeDropperButton",{className:x==null?void 0:x.className,style:x==null?void 0:x.style}),variant:"subtle",color:"gray",size:$.size,unstyled:i,onClick:()=>oe().then(Q=>{if(Q!=null&&Q.sRGBHex){const me=qe(w,is(Q.sRGBHex));I(me),g==null||g(me)}}).catch(()=>{}),children:v||e.jsx(kr,{...W("eyeDropperIcon")})}),ce=Q=>{b==null||b(Q),U(!0)},te=Q=>{u&&I(A),M==null||M(Q),U(!1)},ye=Q=>{S==null||S(Q),U(!0)};return p.useEffect(()=>{(bs(C)||C.trim()==="")&&V(C)},[C]),$s(()=>{bs(C)&&I(qe(w,is(C)))},[w]),e.jsx(We.Wrapper,{...D,classNames:N,styles:q,__staticSelector:"ColorInput",children:e.jsxs(us,{__staticSelector:"ColorInput",position:"bottom-start",offset:5,opened:_,...f,classNames:N,styles:q,unstyled:i,withRoles:!1,disabled:E||k===!1&&(!Array.isArray(F)||F.length===0),children:[e.jsx(us.Target,{children:e.jsx(We,{autoComplete:"off",...X,...$,classNames:N,styles:q,disabled:T,ref:s,__staticSelector:"ColorInput",onFocus:ce,onBlur:te,onClick:ye,spellCheck:!1,value:C,onChange:Q=>{const me=Q.currentTarget.value;I(me),bs(me)&&(g==null||g(qe(w,is(me))))},leftSection:H||(n?e.jsx(Ms,{color:bs(C)?C:"#fff",size:"var(--ci-preview-size)",...W("colorPreview")}):null),readOnly:l||E,pointer:l,unstyled:i,rightSection:O||(m&&!T&&!E&&se?ue:null)})}),e.jsx(us.Dropdown,{onMouseDown:Q=>Q.preventDefault(),className:Mt.dropdown,children:e.jsx(mt,{__staticSelector:"ColorInput",value:C,onChange:I,onChangeEnd:g,format:w,swatches:F,swatchesPerRow:ee,withPicker:k,size:$.size,focusable:!1,unstyled:i,styles:q,classNames:N,onColorSwatchClick:()=>y&&U(!1)})})]})})});pt.classes=er.classes;pt.displayName="@mantine/core/ColorInput";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Lr=Oe("outline","alert-triangle","IconAlertTriangle",[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var $r=Oe("outline","arrows-join","IconArrowsJoin",[["path",{d:"M3 7h5l3.5 5h9.5",key:"svg-0"}],["path",{d:"M3 17h5l3.495 -5",key:"svg-1"}],["path",{d:"M18 15l3 -3l-3 -3",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Er=Oe("outline","circle-check","IconCircleCheck",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 12l2 2l4 -4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var $t=Oe("outline","clock-hour-4","IconClockHour4",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M12 12l3 2",key:"svg-1"}],["path",{d:"M12 7v5",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var zr=Oe("outline","device-floppy","IconDeviceFloppy",[["path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14 4l0 4l-6 0l0 -4",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ar=Oe("outline","eye","IconEye",[["path",{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Nr=Oe("outline","files","IconFiles",[["path",{d:"M15 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M18 17h-7a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h4l5 5v7a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M16 17v2a2 2 0 0 1 -2 2h-7a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h2",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ir=Oe("outline","flask","IconFlask",[["path",{d:"M9 3l6 0",key:"svg-0"}],["path",{d:"M10 9l4 0",key:"svg-1"}],["path",{d:"M10 3v6l-4 11a.7 .7 0 0 0 .5 1h11a.7 .7 0 0 0 .5 -1l-4 -11v-6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var gs=Oe("outline","help-circle","IconHelpCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 16v.01",key:"svg-1"}],["path",{d:"M12 13a2 2 0 0 0 .914 -3.782a1.98 1.98 0 0 0 -2.414 .483",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Rr=Oe("outline","map-pin","IconMapPin",[["path",{d:"M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-0"}],["path",{d:"M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Pr=Oe("outline","player-play","IconPlayerPlay",[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Is=Oe("outline","refresh","IconRefresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Tr=Oe("outline","repeat","IconRepeat",[["path",{d:"M4 12v-3a3 3 0 0 1 3 -3h13m-3 -3l3 3l-3 3",key:"svg-0"}],["path",{d:"M20 12v3a3 3 0 0 1 -3 3h-13m3 3l-3 -3l3 -3",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ra=Oe("outline","star-off","IconStarOff",[["path",{d:"M3 3l18 18",key:"svg-0"}],["path",{d:"M10.012 6.016l1.981 -4.014l3.086 6.253l6.9 1l-4.421 4.304m.012 4.01l.588 3.426l-6.158 -3.245l-6.172 3.245l1.179 -6.873l-5 -4.867l6.327 -.917",key:"svg-1"}]]);function Fr(t){return{all:t=t||new Map,on:function(s,a){var r=t.get(s);r?r.push(a):t.set(s,[a])},off:function(s,a){var r=t.get(s);r&&(a?r.splice(r.indexOf(a)>>>0,1):t.set(s,[]))},emit:function(s,a){var r=t.get(s);r&&r.slice().map(function(o){o(a)}),(r=t.get("*"))&&r.slice().map(function(o){o(s,a)})}}}const hs=Fr(),Or=({lectores:t})=>{if(!Array.isArray(t))return console.log("CasoMap re-renderizando, pero lectores no es un array válido."),e.jsx(ie,{style:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ne,{c:"dimmed",children:"Esperando datos de lectores para el mapa..."})});if(console.log("CasoMap re-renderizando. Número de lectores recibidos:",t.length),t.length===0)return e.jsx(ie,{style:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ne,{c:"dimmed",children:"No hay lectores con coordenadas válidas para mostrar en el mapa."})});const s=t.length>0?[t[0].Coordenada_Y,t[0].Coordenada_X]:[40.416775,-3.70379],a=t.length>0?13:6;return e.jsxs(Ft,{center:s,zoom:a,scrollWheelZoom:!0,style:{height:"100%",width:"100%"},children:[e.jsx(Ot,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.map(r=>{var o,i;return e.jsx(Vt,{position:[r.Coordenada_Y,r.Coordenada_X],children:e.jsxs(Yt,{children:[e.jsx("b",{children:"Lector:"})," ",r.ID_Lector," ",e.jsx("br",{}),r.Nombre&&e.jsxs(e.Fragment,{children:[e.jsx("b",{children:"Nombre:"})," ",r.Nombre,e.jsx("br",{})]}),r.Carretera&&e.jsxs(e.Fragment,{children:[e.jsx("b",{children:"Carretera:"})," ",r.Carretera,e.jsx("br",{})]}),r.Provincia&&e.jsxs(e.Fragment,{children:[e.jsx("b",{children:"Provincia:"})," ",r.Provincia,e.jsx("br",{})]}),r.Organismo_Regulador&&e.jsxs(e.Fragment,{children:[e.jsx("b",{children:"Organismo:"})," ",r.Organismo_Regulador,e.jsx("br",{})]}),"Coords: ",(o=r.Coordenada_Y)==null?void 0:o.toFixed(5),", ",(i=r.Coordenada_X)==null?void 0:i.toFixed(5)]})},r.ID_Lector)})]},t.length)},Vr=({opened:t,onClose:s,lecturaRelevante:a,onSave:r})=>{const[o,i]=p.useState(""),[l,u]=p.useState(!1);p.useEffect(()=>{i(a&&a.Nota||"")},[a]);const f=async()=>{if(a){u(!0);try{await r(a.ID_Relevante,o.trim()||null)}catch(m){console.error("Error guardando nota desde modal:",m)}finally{u(!1)}}},n=()=>{u(!1),s()};return e.jsxs(Ps,{opened:t,onClose:n,title:a?`Editar Nota - Lectura ID: ${a.ID_Lectura}`:"Editar Nota",overlayProps:{backgroundOpacity:.55,blur:3},children:[e.jsx(Ke,{visible:l,overlayProps:{blur:2}}),e.jsx(lt,{label:"Nota de Relevancia",placeholder:"Añade o edita tu nota aquí...",value:o,onChange:m=>i(m.currentTarget.value),minRows:3,autosize:!0,disabled:l}),e.jsxs(we,{justify:"flex-end",mt:"md",children:[e.jsx(be,{variant:"default",onClick:n,disabled:l,children:"Cancelar"}),e.jsx(be,{onClick:f,loading:l,children:"Guardar Nota"})]})]})};function Yr({type:t,date:s,locale:a,format:r,labelSeparator:o}){const i=l=>L(l).locale(a).format(r);return t==="default"?s===null?"":i(s):t==="multiple"?s.map(i).join(", "):t==="range"&&Array.isArray(s)?s[0]&&s[1]?`${i(s[0])} ${o} ${i(s[1])}`:s[0]?`${i(s[0])} ${o} `:"":""}function Hr({formatter:t,...s}){return(t||Yr)(s)}function Br({direction:t,levelIndex:s,rowIndex:a,cellIndex:r,size:o}){switch(t){case"up":return s===0&&a===0?null:a===0?{levelIndex:s-1,rowIndex:r<=o[s-1][o[s-1].length-1]-1?o[s-1].length-1:o[s-1].length-2,cellIndex:r}:{levelIndex:s,rowIndex:a-1,cellIndex:r};case"down":return a===o[s].length-1?{levelIndex:s+1,rowIndex:0,cellIndex:r}:a===o[s].length-2&&r>=o[s][o[s].length-1]?{levelIndex:s+1,rowIndex:0,cellIndex:r}:{levelIndex:s,rowIndex:a+1,cellIndex:r};case"left":return s===0&&a===0&&r===0?null:a===0&&r===0?{levelIndex:s-1,rowIndex:o[s-1].length-1,cellIndex:o[s-1][o[s-1].length-1]-1}:r===0?{levelIndex:s,rowIndex:a-1,cellIndex:o[s][a-1]-1}:{levelIndex:s,rowIndex:a,cellIndex:r-1};case"right":return a===o[s].length-1&&r===o[s][a]-1?{levelIndex:s+1,rowIndex:0,cellIndex:0}:r===o[s][a]-1?{levelIndex:s,rowIndex:a+1,cellIndex:0}:{levelIndex:s,rowIndex:a,cellIndex:r+1};default:return{levelIndex:s,rowIndex:a,cellIndex:r}}}function oa({controlsRef:t,direction:s,levelIndex:a,rowIndex:r,cellIndex:o,size:i}){var f,n,m;const l=Br({direction:s,size:i,rowIndex:r,cellIndex:o,levelIndex:a});if(!l)return;const u=(m=(n=(f=t.current)==null?void 0:f[l.levelIndex])==null?void 0:n[l.rowIndex])==null?void 0:m[l.cellIndex];u&&(u.disabled||u.getAttribute("data-hidden")||u.getAttribute("data-outside")?oa({controlsRef:t,direction:s,levelIndex:l.levelIndex,cellIndex:l.cellIndex,rowIndex:l.rowIndex,size:i}):u.focus())}function qr(t){switch(t){case"ArrowDown":return"down";case"ArrowUp":return"up";case"ArrowRight":return"right";case"ArrowLeft":return"left";default:return null}}function Gr(t){var s;return(s=t.current)==null?void 0:s.map(a=>a.map(r=>r.length))}function ft({controlsRef:t,levelIndex:s,rowIndex:a,cellIndex:r,event:o}){const i=qr(o.key);if(i){o.preventDefault();const l=Gr(t);oa({controlsRef:t,direction:i,levelIndex:s,rowIndex:a,cellIndex:r,size:l})}}var na={exports:{}};(function(t,s){(function(a,r){t.exports=r()})(ot,function(){var a={year:0,month:1,day:2,hour:3,minute:4,second:5},r={};return function(o,i,l){var u,f=function(y,x,h){h===void 0&&(h={});var c=new Date(y),j=function(g,S){S===void 0&&(S={});var b=S.timeZoneName||"short",M=g+"|"+b,$=r[M];return $||($=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:g,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:b}),r[M]=$),$}(x,h);return j.formatToParts(c)},n=function(y,x){for(var h=f(y,x),c=[],j=0;j<h.length;j+=1){var g=h[j],S=g.type,b=g.value,M=a[S];M>=0&&(c[M]=parseInt(b,10))}var $=c[3],w=$===24?0:$,D=c[0]+"-"+c[1]+"-"+c[2]+" "+w+":"+c[4]+":"+c[5]+":000",E=+y;return(l.utc(D).valueOf()-(E-=E%1e3))/6e4},m=i.prototype;m.tz=function(y,x){y===void 0&&(y=u);var h,c=this.utcOffset(),j=this.toDate(),g=j.toLocaleString("en-US",{timeZone:y}),S=Math.round((j-new Date(g))/1e3/60),b=15*-Math.round(j.getTimezoneOffset()/15)-S;if(!Number(b))h=this.utcOffset(0,x);else if(h=l(g,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(b,!0),x){var M=h.utcOffset();h=h.add(c-M,"minute")}return h.$x.$timezone=y,h},m.offsetName=function(y){var x=this.$x.$timezone||l.tz.guess(),h=f(this.valueOf(),x,{timeZoneName:y}).find(function(c){return c.type.toLowerCase()==="timezonename"});return h&&h.value};var v=m.startOf;m.startOf=function(y,x){if(!this.$x||!this.$x.$timezone)return v.call(this,y,x);var h=l(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return v.call(h,y,x).tz(this.$x.$timezone,!0)},l.tz=function(y,x,h){var c=h&&x,j=h||x||u,g=n(+l(),j);if(typeof y!="string")return l(y).tz(j);var S=function(w,D,E){var k=w-60*D*1e3,F=n(k,E);if(D===F)return[k,D];var T=n(k-=60*(F-D)*1e3,E);return F===T?[k,F]:[w-60*Math.min(F,T)*1e3,Math.max(F,T)]}(l.utc(y,c).valueOf(),g,j),b=S[0],M=S[1],$=l(b).utcOffset(M);return $.$x.$timezone=j,$},l.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},l.tz.setDefault=function(y){u=y}}})})(na);var Wr=na.exports;const Ur=nt(Wr);var la={exports:{}};(function(t,s){(function(a,r){t.exports=r()})(ot,function(){var a="minute",r=/[+-]\d\d(?::?\d\d)?/g,o=/([+-]|\d\d)/g;return function(i,l,u){var f=l.prototype;u.utc=function(c){var j={date:c,utc:!0,args:arguments};return new l(j)},f.utc=function(c){var j=u(this.toDate(),{locale:this.$L,utc:!0});return c?j.add(this.utcOffset(),a):j},f.local=function(){return u(this.toDate(),{locale:this.$L,utc:!1})};var n=f.parse;f.parse=function(c){c.utc&&(this.$u=!0),this.$utils().u(c.$offset)||(this.$offset=c.$offset),n.call(this,c)};var m=f.init;f.init=function(){if(this.$u){var c=this.$d;this.$y=c.getUTCFullYear(),this.$M=c.getUTCMonth(),this.$D=c.getUTCDate(),this.$W=c.getUTCDay(),this.$H=c.getUTCHours(),this.$m=c.getUTCMinutes(),this.$s=c.getUTCSeconds(),this.$ms=c.getUTCMilliseconds()}else m.call(this)};var v=f.utcOffset;f.utcOffset=function(c,j){var g=this.$utils().u;if(g(c))return this.$u?0:g(this.$offset)?v.call(this):this.$offset;if(typeof c=="string"&&(c=function($){$===void 0&&($="");var w=$.match(r);if(!w)return null;var D=(""+w[0]).match(o)||["-",0,0],E=D[0],k=60*+D[1]+ +D[2];return k===0?0:E==="+"?k:-k}(c),c===null))return this;var S=Math.abs(c)<=16?60*c:c,b=this;if(j)return b.$offset=S,b.$u=c===0,b;if(c!==0){var M=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(b=this.local().add(S+M,a)).$offset=S,b.$x.$localOffset=M}else b=this.utc();return b};var y=f.format;f.format=function(c){var j=c||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return y.call(this,j)},f.valueOf=function(){var c=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*c},f.isUTC=function(){return!!this.$u},f.toISOString=function(){return this.toDate().toISOString()},f.toString=function(){return this.toDate().toUTCString()};var x=f.toDate;f.toDate=function(c){return c==="s"&&this.$offset?u(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():x.call(this)};var h=f.diff;f.diff=function(c,j,g){if(c&&this.$u===c.$u)return h.call(this,c,j,g);var S=this.local(),b=u(c).local();return h.call(S,b,j,g)}}})})(la);var Kr=la.exports;const Zr=nt(Kr);L.extend(Zr);L.extend(Ur);function Xr(t,s){return s?L(t).tz(s).utcOffset()+t.getTimezoneOffset():0}const Et=(t,s,a)=>{if(!t)return null;if(!s)return t;let r=Xr(t,s);return a==="remove"&&(r*=-1),L(t).add(r,"minutes").toDate()};function Qe(t,s,a,r){return r||!s?s:Array.isArray(s)?s.map(o=>Et(o,a,t)):Et(s,a,t)}function Jr({minDate:t,maxDate:s,timezone:a}){const r=Qe("add",new Date,a);return!t&&!s?r:t&&L(r).isBefore(t)?t:s&&L(r).isAfter(s)?s:r}const Qr={locale:"en",timezone:null,firstDayOfWeek:1,weekendDays:[0,6],labelSeparator:"–",consistentWeeks:!1},eo=p.createContext(Qr);function Ve(){const t=p.useContext(eo),s=p.useCallback(l=>l||t.locale,[t.locale]),a=p.useCallback(l=>l||t.timezone||void 0,[t.timezone]),r=p.useCallback(l=>typeof l=="number"?l:t.firstDayOfWeek,[t.firstDayOfWeek]),o=p.useCallback(l=>Array.isArray(l)?l:t.weekendDays,[t.weekendDays]),i=p.useCallback(l=>typeof l=="string"?l:t.labelSeparator,[t.labelSeparator]);return{...t,getLocale:s,getTimezone:a,getFirstDayOfWeek:r,getWeekendDays:o,getLabelSeparator:i}}function so(t,s){const a=Ve(),r=o=>Qe("remove",o,a.getTimezone()).toISOString();if(s==="range"&&Array.isArray(t)){const[o,i]=t;return o?i?`${r(o)} – ${r(i)}`:`${r(o)} –`:""}return s==="multiple"&&Array.isArray(t)?t.map(o=>o&&r(o)).filter(Boolean).join(", "):!Array.isArray(t)&&t?r(t):""}function ia({value:t,type:s,name:a,form:r}){return e.jsx("input",{type:"hidden",value:so(t,s),name:a,form:r})}ia.displayName="@mantine/dates/HiddenDatesInput";var ca={day:"m_396ce5cb"};const to={},ao=Ze((t,{size:s})=>({day:{"--day-size":Ie(s,"day-size")}})),gt=Ce((t,s)=>{const a=xe("Day",to,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,date:n,disabled:m,__staticSelector:v,weekend:y,outside:x,selected:h,renderDay:c,inRange:j,firstInRange:g,lastInRange:S,hidden:b,static:M,highlightToday:$,...w}=a,D=Fe({name:v||"Day",classes:ca,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,varsResolver:ao,rootSelector:"day"}),E=Ve();return e.jsx(js,{...D("day",{style:b?{display:"none"}:void 0}),component:M?"div":"button",ref:s,disabled:m,"data-today":L(n).isSame(Qe("add",new Date,E.getTimezone()),"day")||void 0,"data-hidden":b||void 0,"data-highlight-today":$||void 0,"data-disabled":m||void 0,"data-weekend":!m&&!x&&y||void 0,"data-outside":!m&&x||void 0,"data-selected":!m&&h||void 0,"data-in-range":j&&!m||void 0,"data-first-in-range":g&&!m||void 0,"data-last-in-range":S&&!m||void 0,"data-static":M||void 0,unstyled:u,...w,children:(c==null?void 0:c(n))||L(n).date()})});gt.classes=ca;gt.displayName="@mantine/dates/Day";function ro({locale:t,format:s="dd",firstDayOfWeek:a=1}){const r=L().day(a),o=[];for(let i=0;i<7;i+=1)typeof s=="string"?o.push(L(r).add(i,"days").locale(t).format(s)):o.push(s(L(r).add(i,"days").toDate()));return o}var da={weekday:"m_18a3eca"};const oo={},no=Ze((t,{size:s})=>({weekdaysRow:{"--wr-fz":Ds(s),"--wr-spacing":rt(s)}})),vt=Ce((t,s)=>{const a=xe("WeekdaysRow",oo,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,locale:n,firstDayOfWeek:m,weekdayFormat:v,cellComponent:y="th",__staticSelector:x,withWeekNumbers:h,...c}=a,j=Fe({name:x||"WeekdaysRow",classes:da,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,varsResolver:no,rootSelector:"weekdaysRow"}),g=Ve(),S=ro({locale:g.getLocale(n),format:v,firstDayOfWeek:g.getFirstDayOfWeek(m)}).map((b,M)=>e.jsx(y,{...j("weekday"),children:b},M));return e.jsxs(ie,{component:"tr",ref:s,...j("weekdaysRow"),...c,children:[h&&e.jsx(y,{...j("weekday"),children:"#"}),S]})});vt.classes=da;vt.displayName="@mantine/dates/WeekdaysRow";function lo(t,s=1){let a=L(t);const r=s===0?6:s-1;for(;a.day()!==r;)a=a.add(1,"day");return a.toDate()}function io(t,s=1){let a=L(t);for(;a.day()!==s;)a=a.subtract(1,"day");return a.toDate()}function co({month:t,firstDayOfWeek:s=1,consistentWeeks:a}){const r=L(t).subtract(L(t).date()-1,"day"),o=L(r).startOf("day"),i=o.toDate(),l=o.add(+o.daysInMonth()-1,"day").toDate(),u=lo(l,s),f=io(i,s),n=[];for(;f<=u;){const m=[];for(let v=0;v<7;v+=1)m.push(new Date(f)),f.setDate(f.getDate()+1);n.push(m)}if(a&&n.length<6){const m=n[n.length-1],v=m[m.length-1],y=new Date(v);for(y.setDate(y.getDate()+1);n.length<6;){const x=[];for(let h=0;h<7;h+=1)x.push(new Date(y)),y.setDate(y.getDate()+1);n.push(x)}}return n}function ua(t,s){return s instanceof Date?L(t).isAfter(L(s).subtract(1,"day"),"day"):!0}function ha(t,s){return s instanceof Date?L(t).isBefore(L(s).add(1,"day"),"day"):!0}function uo(t,s,a,r,o,i,l){const u=t.flat().filter(m=>{var v;return ha(m,a)&&ua(m,s)&&!(o!=null&&o(m))&&!((v=r==null?void 0:r(m))!=null&&v.disabled)&&(!i||L(m).isSame(L(l),"month"))}),f=u.find(m=>{var v;return(v=r==null?void 0:r(m))==null?void 0:v.selected});if(f)return f;const n=u.find(m=>L().isSame(m,"date"));return n||u[0]}var ma={exports:{}};(function(t,s){(function(a,r){t.exports=r()})(ot,function(){var a="day";return function(r,o,i){var l=function(n){return n.add(4-n.isoWeekday(),a)},u=o.prototype;u.isoWeekYear=function(){return l(this).year()},u.isoWeek=function(n){if(!this.$utils().u(n))return this.add(7*(n-this.isoWeek()),a);var m,v,y,x,h=l(this),c=(m=this.isoWeekYear(),v=this.$u,y=(v?i.utc:i)().year(m).startOf("year"),x=4-y.isoWeekday(),y.isoWeekday()>4&&(x+=7),y.add(x,a));return h.diff(c,"week")+1},u.isoWeekday=function(n){return this.$utils().u(n)?this.day()||7:this.day(this.day()%7?n:n-7)};var f=u.startOf;u.startOf=function(n,m){var v=this.$utils(),y=!!v.u(m)||m;return v.p(n)==="isoweek"?y?this.date(this.date()-(this.isoWeekday()-1)).startOf("day"):this.date(this.date()-1-(this.isoWeekday()-1)+7).endOf("day"):f.bind(this)(n,m)}}})})(ma);var ho=ma.exports;const mo=nt(ho);L.extend(mo);function po(t){const s=t.find(a=>L(a).day()===1);return L(s).isoWeek()}var pa={month:"m_cc9820d3",monthCell:"m_8f457cd5",weekNumber:"m_6cff9dea"};const fo={withCellSpacing:!0},go=Ze((t,{size:s})=>({weekNumber:{"--wn-fz":Ds(s),"--wn-size":Ie(s,"wn-size")}})),Ts=Ce((t,s)=>{const a=xe("Month",fo,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,__staticSelector:n,locale:m,firstDayOfWeek:v,weekdayFormat:y,month:x,weekendDays:h,getDayProps:c,excludeDate:j,minDate:g,maxDate:S,renderDay:b,hideOutsideDates:M,hideWeekdays:$,getDayAriaLabel:w,static:D,__getDayRef:E,__onDayKeyDown:k,__onDayClick:F,__onDayMouseEnter:T,__preventFocus:H,__stopPropagation:O,withCellSpacing:ee,size:X,highlightToday:W,withWeekNumbers:N,...q}=a,_=Fe({name:n||"Month",classes:pa,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,varsResolver:go,rootSelector:"month"}),U=Ve(),A=co({month:x,firstDayOfWeek:U.getFirstDayOfWeek(v),consistentWeeks:U.consistentWeeks}),V=uo(A,g,S,c,j,M,x),{resolvedClassNames:C,resolvedStyles:I}=ks({classNames:r,styles:l,props:a}),se=A.map((oe,ue)=>{const ce=oe.map((te,ye)=>{const Q=!L(te).isSame(L(x),"month"),me=(w==null?void 0:w(te))||L(te).locale(m||U.locale).format("D MMMM YYYY"),re=c==null?void 0:c(te),Se=L(te).isSame(V,"date");return e.jsx("td",{..._("monthCell"),"data-with-spacing":ee||void 0,children:e.jsx(gt,{__staticSelector:n||"Month",classNames:C,styles:I,unstyled:u,"data-mantine-stop-propagation":O||void 0,highlightToday:W,renderDay:b,date:te,size:X,weekend:U.getWeekendDays(h).includes(te.getDay()),outside:Q,hidden:M?Q:!1,"aria-label":me,static:D,disabled:(j==null?void 0:j(te))||!ha(te,S)||!ua(te,g),ref:ge=>E==null?void 0:E(ue,ye,ge),...re,onKeyDown:ge=>{var je;(je=re==null?void 0:re.onKeyDown)==null||je.call(re,ge),k==null||k(ge,{rowIndex:ue,cellIndex:ye,date:te})},onMouseEnter:ge=>{var je;(je=re==null?void 0:re.onMouseEnter)==null||je.call(re,ge),T==null||T(ge,te)},onClick:ge=>{var je;(je=re==null?void 0:re.onClick)==null||je.call(re,ge),F==null||F(ge,te)},onMouseDown:ge=>{var je;(je=re==null?void 0:re.onMouseDown)==null||je.call(re,ge),H&&ge.preventDefault()},tabIndex:H||!Se?-1:0})},te.toString())});return e.jsxs("tr",{..._("monthRow"),children:[N&&e.jsx("td",{..._("weekNumber"),children:po(oe)}),ce]},ue)});return e.jsxs(ie,{component:"table",..._("month"),size:X,ref:s,...q,children:[!$&&e.jsx("thead",{..._("monthThead"),children:e.jsx(vt,{__staticSelector:n||"Month",locale:m,firstDayOfWeek:v,weekdayFormat:y,size:X,classNames:C,styles:I,unstyled:u,withWeekNumbers:N})}),e.jsx("tbody",{..._("monthTbody"),children:se})]})});Ts.classes=pa;Ts.displayName="@mantine/dates/Month";var fa={pickerControl:"m_dc6a3c71"};const vo={},xo=Ze((t,{size:s})=>({pickerControl:{"--dpc-fz":Ds(s),"--dpc-size":Ie(s,"dpc-size")}})),Fs=Ce((t,s)=>{const a=xe("PickerControl",vo,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,firstInRange:n,lastInRange:m,inRange:v,__staticSelector:y,selected:x,disabled:h,...c}=a,j=Fe({name:y||"PickerControl",classes:fa,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,varsResolver:xo,rootSelector:"pickerControl"});return e.jsx(js,{...j("pickerControl"),ref:s,unstyled:u,"data-picker-control":!0,"data-selected":x&&!h||void 0,"data-disabled":h||void 0,"data-in-range":v&&!h&&!x||void 0,"data-first-in-range":n&&!h||void 0,"data-last-in-range":m&&!h||void 0,disabled:h,...c})});Fs.classes=fa;Fs.displayName="@mantine/dates/PickerControl";function ga(t,s,a){return!s&&!a?!1:!!(s&&L(t).isBefore(s,"year")||a&&L(t).isAfter(a,"year"))}function yo(t,s,a,r){const o=t.flat().filter(u=>{var f;return!ga(u,s,a)&&!((f=r==null?void 0:r(u))!=null&&f.disabled)}),i=o.find(u=>{var f;return(f=r==null?void 0:r(u))==null?void 0:f.selected});if(i)return i;const l=o.find(u=>L().isSame(u,"year"));return l||o[0]}function va(t){const s=t.getFullYear(),a=s-s%10;let r=0;const o=[[],[],[],[]];for(let i=0;i<4;i+=1){const l=i===3?1:3;for(let u=0;u<l;u+=1)o[i].push(new Date(a+r,0)),r+=1}return o}var xa={yearsList:"m_9206547b",yearsListCell:"m_c5a19c7d"};const bo={yearsListFormat:"YYYY",withCellSpacing:!0},Os=Ce((t,s)=>{const a=xe("YearsList",bo,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,decade:n,yearsListFormat:m,locale:v,minDate:y,maxDate:x,getYearControlProps:h,__staticSelector:c,__getControlRef:j,__onControlKeyDown:g,__onControlClick:S,__onControlMouseEnter:b,__preventFocus:M,__stopPropagation:$,withCellSpacing:w,size:D,...E}=a,k=Fe({name:c||"YearsList",classes:xa,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,rootSelector:"yearsList"}),F=Ve(),T=va(n),H=yo(T,y,x,h),O=T.map((ee,X)=>{const W=ee.map((N,q)=>{const _=h==null?void 0:h(N),U=L(N).isSame(H,"year");return e.jsx("td",{...k("yearsListCell"),"data-with-spacing":w||void 0,children:e.jsx(Fs,{...k("yearsListControl"),size:D,unstyled:u,"data-mantine-stop-propagation":$||void 0,disabled:ga(N,y,x),ref:A=>j==null?void 0:j(X,q,A),..._,onKeyDown:A=>{var V;(V=_==null?void 0:_.onKeyDown)==null||V.call(_,A),g==null||g(A,{rowIndex:X,cellIndex:q,date:N})},onClick:A=>{var V;(V=_==null?void 0:_.onClick)==null||V.call(_,A),S==null||S(A,N)},onMouseEnter:A=>{var V;(V=_==null?void 0:_.onMouseEnter)==null||V.call(_,A),b==null||b(A,N)},onMouseDown:A=>{var V;(V=_==null?void 0:_.onMouseDown)==null||V.call(_,A),M&&A.preventDefault()},tabIndex:M||!U?-1:0,children:L(N).locale(F.getLocale(v)).format(m)})},q)});return e.jsx("tr",{...k("yearsListRow"),children:W},X)});return e.jsx(ie,{component:"table",ref:s,size:D,...k("yearsList"),...E,children:e.jsx("tbody",{children:O})})});Os.classes=xa;Os.displayName="@mantine/dates/YearsList";function ya(t,s,a){return!s&&!a?!1:!!(s&&L(t).isBefore(s,"month")||a&&L(t).isAfter(a,"month"))}function jo(t,s,a,r){const o=t.flat().filter(u=>{var f;return!ya(u,s,a)&&!((f=r==null?void 0:r(u))!=null&&f.disabled)}),i=o.find(u=>{var f;return(f=r==null?void 0:r(u))==null?void 0:f.selected});if(i)return i;const l=o.find(u=>L().isSame(u,"month"));return l||o[0]}function wo(t){const s=L(t).startOf("year").toDate(),a=[[],[],[],[]];let r=0;for(let o=0;o<4;o+=1)for(let i=0;i<3;i+=1)a[o].push(L(s).add(r,"months").toDate()),r+=1;return a}var ba={monthsList:"m_2a6c32d",monthsListCell:"m_fe27622f"};const Co={monthsListFormat:"MMM",withCellSpacing:!0},Vs=Ce((t,s)=>{const a=xe("MonthsList",Co,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,__staticSelector:n,year:m,monthsListFormat:v,locale:y,minDate:x,maxDate:h,getMonthControlProps:c,__getControlRef:j,__onControlKeyDown:g,__onControlClick:S,__onControlMouseEnter:b,__preventFocus:M,__stopPropagation:$,withCellSpacing:w,size:D,...E}=a,k=Fe({name:n||"MonthsList",classes:ba,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,rootSelector:"monthsList"}),F=Ve(),T=wo(m),H=jo(T,x,h,c),O=T.map((ee,X)=>{const W=ee.map((N,q)=>{const _=c==null?void 0:c(N),U=L(N).isSame(H,"month");return e.jsx("td",{...k("monthsListCell"),"data-with-spacing":w||void 0,children:e.jsx(Fs,{...k("monthsListControl"),size:D,unstyled:u,__staticSelector:n||"MonthsList","data-mantine-stop-propagation":$||void 0,disabled:ya(N,x,h),ref:A=>j==null?void 0:j(X,q,A),..._,onKeyDown:A=>{var V;(V=_==null?void 0:_.onKeyDown)==null||V.call(_,A),g==null||g(A,{rowIndex:X,cellIndex:q,date:N})},onClick:A=>{var V;(V=_==null?void 0:_.onClick)==null||V.call(_,A),S==null||S(A,N)},onMouseEnter:A=>{var V;(V=_==null?void 0:_.onMouseEnter)==null||V.call(_,A),b==null||b(A,N)},onMouseDown:A=>{var V;(V=_==null?void 0:_.onMouseDown)==null||V.call(_,A),M&&A.preventDefault()},tabIndex:M||!U?-1:0,children:L(N).locale(F.getLocale(y)).format(v)})},q)});return e.jsx("tr",{...k("monthsListRow"),children:W},X)});return e.jsx(ie,{component:"table",ref:s,size:D,...k("monthsList"),...E,children:e.jsx("tbody",{children:O})})});Vs.classes=ba;Vs.displayName="@mantine/dates/MonthsList";var ja={calendarHeader:"m_730a79ed",calendarHeaderLevel:"m_f6645d97",calendarHeaderControl:"m_2351eeb0",calendarHeaderControlIcon:"m_367dc749"};const So={nextDisabled:!1,previousDisabled:!1,hasNextLevel:!0,withNext:!0,withPrevious:!0},_o=Ze((t,{size:s})=>({calendarHeader:{"--dch-control-size":Ie(s,"dch-control-size"),"--dch-fz":Ds(s)}})),ts=Ce((t,s)=>{const a=xe("CalendarHeader",So,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,nextIcon:n,previousIcon:m,nextLabel:v,previousLabel:y,onNext:x,onPrevious:h,onLevelClick:c,label:j,nextDisabled:g,previousDisabled:S,hasNextLevel:b,levelControlAriaLabel:M,withNext:$,withPrevious:w,__staticSelector:D,__preventFocus:E,__stopPropagation:k,...F}=a,T=Fe({name:D||"CalendarHeader",classes:ja,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,varsResolver:_o,rootSelector:"calendarHeader"}),H=E?O=>O.preventDefault():void 0;return e.jsxs(ie,{...T("calendarHeader"),ref:s,...F,children:[w&&e.jsx(js,{...T("calendarHeaderControl"),"data-direction":"previous","aria-label":y,onClick:h,unstyled:u,onMouseDown:H,disabled:S,"data-disabled":S||void 0,tabIndex:E||S?-1:0,"data-mantine-stop-propagation":k||void 0,children:m||e.jsx(yt,{...T("calendarHeaderControlIcon"),"data-direction":"previous",size:"45%"})}),e.jsx(js,{component:b?"button":"div",...T("calendarHeaderLevel"),onClick:b?c:void 0,unstyled:u,onMouseDown:b?H:void 0,disabled:!b,"data-static":!b||void 0,"aria-label":M,tabIndex:E||!b?-1:0,"data-mantine-stop-propagation":k||void 0,children:j}),$&&e.jsx(js,{...T("calendarHeaderControl"),"data-direction":"next","aria-label":v,onClick:x,unstyled:u,onMouseDown:H,disabled:g,"data-disabled":g||void 0,tabIndex:E||g?-1:0,"data-mantine-stop-propagation":k||void 0,children:n||e.jsx(yt,{...T("calendarHeaderControlIcon"),"data-direction":"next",size:"45%"})})]})});ts.classes=ja;ts.displayName="@mantine/dates/CalendarHeader";function Do(t){const s=va(t);return[s[0][0],s[3][0]]}const ko={decadeLabelFormat:"YYYY"},Ys=Ce((t,s)=>{const a=xe("DecadeLevel",ko,t),{decade:r,locale:o,minDate:i,maxDate:l,yearsListFormat:u,getYearControlProps:f,__getControlRef:n,__onControlKeyDown:m,__onControlClick:v,__onControlMouseEnter:y,withCellSpacing:x,__preventFocus:h,nextIcon:c,previousIcon:j,nextLabel:g,previousLabel:S,onNext:b,onPrevious:M,nextDisabled:$,previousDisabled:w,levelControlAriaLabel:D,withNext:E,withPrevious:k,decadeLabelFormat:F,classNames:T,styles:H,unstyled:O,__staticSelector:ee,__stopPropagation:X,size:W,...N}=a,q=Ve(),[_,U]=Do(r),A={__staticSelector:ee||"DecadeLevel",classNames:T,styles:H,unstyled:O,size:W},V=typeof $=="boolean"?$:l?!L(U).endOf("year").isBefore(l):!1,C=typeof w=="boolean"?w:i?!L(_).startOf("year").isAfter(i):!1,I=(se,oe)=>L(se).locale(o||q.locale).format(oe);return e.jsxs(ie,{"data-decade-level":!0,size:W,ref:s,...N,children:[e.jsx(ts,{label:typeof F=="function"?F(_,U):`${I(_,F)} – ${I(U,F)}`,__preventFocus:h,__stopPropagation:X,nextIcon:c,previousIcon:j,nextLabel:g,previousLabel:S,onNext:b,onPrevious:M,nextDisabled:V,previousDisabled:C,hasNextLevel:!1,levelControlAriaLabel:D,withNext:E,withPrevious:k,...A}),e.jsx(Os,{decade:r,locale:o,minDate:i,maxDate:l,yearsListFormat:u,getYearControlProps:f,__getControlRef:n,__onControlKeyDown:m,__onControlClick:v,__onControlMouseEnter:y,__preventFocus:h,__stopPropagation:X,withCellSpacing:x,...A})]})});Ys.classes={...Os.classes,...ts.classes};Ys.displayName="@mantine/dates/DecadeLevel";const Mo={yearLabelFormat:"YYYY"},Hs=Ce((t,s)=>{const a=xe("YearLevel",Mo,t),{year:r,locale:o,minDate:i,maxDate:l,monthsListFormat:u,getMonthControlProps:f,__getControlRef:n,__onControlKeyDown:m,__onControlClick:v,__onControlMouseEnter:y,withCellSpacing:x,__preventFocus:h,nextIcon:c,previousIcon:j,nextLabel:g,previousLabel:S,onNext:b,onPrevious:M,onLevelClick:$,nextDisabled:w,previousDisabled:D,hasNextLevel:E,levelControlAriaLabel:k,withNext:F,withPrevious:T,yearLabelFormat:H,__staticSelector:O,__stopPropagation:ee,size:X,classNames:W,styles:N,unstyled:q,..._}=a,U=Ve(),A={__staticSelector:O||"YearLevel",classNames:W,styles:N,unstyled:q,size:X},V=typeof w=="boolean"?w:l?!L(r).endOf("year").isBefore(l):!1,C=typeof D=="boolean"?D:i?!L(r).startOf("year").isAfter(i):!1;return e.jsxs(ie,{"data-year-level":!0,size:X,ref:s,..._,children:[e.jsx(ts,{label:typeof H=="function"?H(r):L(r).locale(o||U.locale).format(H),__preventFocus:h,__stopPropagation:ee,nextIcon:c,previousIcon:j,nextLabel:g,previousLabel:S,onNext:b,onPrevious:M,onLevelClick:$,nextDisabled:V,previousDisabled:C,hasNextLevel:E,levelControlAriaLabel:k,withNext:F,withPrevious:T,...A}),e.jsx(Vs,{year:r,locale:o,minDate:i,maxDate:l,monthsListFormat:u,getMonthControlProps:f,__getControlRef:n,__onControlKeyDown:m,__onControlClick:v,__onControlMouseEnter:y,__preventFocus:h,__stopPropagation:ee,withCellSpacing:x,...A})]})});Hs.classes={...ts.classes,...Vs.classes};Hs.displayName="@mantine/dates/YearLevel";const Lo={monthLabelFormat:"MMMM YYYY"},Bs=Ce((t,s)=>{const a=xe("MonthLevel",Lo,t),{month:r,locale:o,firstDayOfWeek:i,weekdayFormat:l,weekendDays:u,getDayProps:f,excludeDate:n,minDate:m,maxDate:v,renderDay:y,hideOutsideDates:x,hideWeekdays:h,getDayAriaLabel:c,__getDayRef:j,__onDayKeyDown:g,__onDayClick:S,__onDayMouseEnter:b,withCellSpacing:M,highlightToday:$,withWeekNumbers:w,__preventFocus:D,__stopPropagation:E,nextIcon:k,previousIcon:F,nextLabel:T,previousLabel:H,onNext:O,onPrevious:ee,onLevelClick:X,nextDisabled:W,previousDisabled:N,hasNextLevel:q,levelControlAriaLabel:_,withNext:U,withPrevious:A,monthLabelFormat:V,classNames:C,styles:I,unstyled:se,__staticSelector:oe,size:ue,static:ce,...te}=a,ye=Ve(),Q={__staticSelector:oe||"MonthLevel",classNames:C,styles:I,unstyled:se,size:ue},me=typeof W=="boolean"?W:v?!L(r).endOf("month").isBefore(v):!1,re=typeof N=="boolean"?N:m?!L(r).startOf("month").isAfter(m):!1;return e.jsxs(ie,{"data-month-level":!0,size:ue,ref:s,...te,children:[e.jsx(ts,{label:typeof V=="function"?V(r):L(r).locale(o||ye.locale).format(V),__preventFocus:D,__stopPropagation:E,nextIcon:k,previousIcon:F,nextLabel:T,previousLabel:H,onNext:O,onPrevious:ee,onLevelClick:X,nextDisabled:me,previousDisabled:re,hasNextLevel:q,levelControlAriaLabel:_,withNext:U,withPrevious:A,...Q}),e.jsx(Ts,{month:r,locale:o,firstDayOfWeek:i,weekdayFormat:l,weekendDays:u,getDayProps:f,excludeDate:n,minDate:m,maxDate:v,renderDay:y,hideOutsideDates:x,hideWeekdays:h,getDayAriaLabel:c,__getDayRef:j,__onDayKeyDown:g,__onDayClick:S,__onDayMouseEnter:b,__preventFocus:D,__stopPropagation:E,static:ce,withCellSpacing:M,highlightToday:$,withWeekNumbers:w,...Q})]})});Bs.classes={...Ts.classes,...ts.classes};Bs.displayName="@mantine/dates/MonthLevel";var wa={levelsGroup:"m_30b26e33"};const $o={},as=Ce((t,s)=>{const a=xe("LevelsGroup",$o,t),{classNames:r,className:o,style:i,styles:l,unstyled:u,vars:f,__staticSelector:n,...m}=a,v=Fe({name:n||"LevelsGroup",classes:wa,props:a,className:o,style:i,classNames:r,styles:l,unstyled:u,vars:f,rootSelector:"levelsGroup"});return e.jsx(ie,{ref:s,...v("levelsGroup"),...m})});as.classes=wa;as.displayName="@mantine/dates/LevelsGroup";const Eo={numberOfColumns:1},qs=Ce((t,s)=>{const a=xe("DecadeLevelGroup",Eo,t),{decade:r,locale:o,minDate:i,maxDate:l,yearsListFormat:u,getYearControlProps:f,__onControlClick:n,__onControlMouseEnter:m,withCellSpacing:v,__preventFocus:y,nextIcon:x,previousIcon:h,nextLabel:c,previousLabel:j,onNext:g,onPrevious:S,nextDisabled:b,previousDisabled:M,classNames:$,styles:w,unstyled:D,__staticSelector:E,__stopPropagation:k,numberOfColumns:F,levelControlAriaLabel:T,decadeLabelFormat:H,size:O,vars:ee,...X}=a,W=p.useRef([]),N=Array(F).fill(0).map((q,_)=>{const U=L(r).add(_*10,"years").toDate();return e.jsx(Ys,{size:O,yearsListFormat:u,decade:U,withNext:_===F-1,withPrevious:_===0,decadeLabelFormat:H,__onControlClick:n,__onControlMouseEnter:m,__onControlKeyDown:(A,V)=>ft({levelIndex:_,rowIndex:V.rowIndex,cellIndex:V.cellIndex,event:A,controlsRef:W}),__getControlRef:(A,V,C)=>{Array.isArray(W.current[_])||(W.current[_]=[]),Array.isArray(W.current[_][A])||(W.current[_][A]=[]),W.current[_][A][V]=C},levelControlAriaLabel:typeof T=="function"?T(U):T,locale:o,minDate:i,maxDate:l,__preventFocus:y,__stopPropagation:k,nextIcon:x,previousIcon:h,nextLabel:c,previousLabel:j,onNext:g,onPrevious:S,nextDisabled:b,previousDisabled:M,getYearControlProps:f,__staticSelector:E||"DecadeLevelGroup",classNames:$,styles:w,unstyled:D,withCellSpacing:v},_)});return e.jsx(as,{classNames:$,styles:w,__staticSelector:E||"DecadeLevelGroup",ref:s,size:O,unstyled:D,...X,children:N})});qs.classes={...as.classes,...Ys.classes};qs.displayName="@mantine/dates/DecadeLevelGroup";const zo={numberOfColumns:1},Gs=Ce((t,s)=>{const a=xe("YearLevelGroup",zo,t),{year:r,locale:o,minDate:i,maxDate:l,monthsListFormat:u,getMonthControlProps:f,__onControlClick:n,__onControlMouseEnter:m,withCellSpacing:v,__preventFocus:y,nextIcon:x,previousIcon:h,nextLabel:c,previousLabel:j,onNext:g,onPrevious:S,onLevelClick:b,nextDisabled:M,previousDisabled:$,hasNextLevel:w,classNames:D,styles:E,unstyled:k,__staticSelector:F,__stopPropagation:T,numberOfColumns:H,levelControlAriaLabel:O,yearLabelFormat:ee,size:X,vars:W,...N}=a,q=p.useRef([]),_=Array(H).fill(0).map((U,A)=>{const V=L(r).add(A,"years").toDate();return e.jsx(Hs,{size:X,monthsListFormat:u,year:V,withNext:A===H-1,withPrevious:A===0,yearLabelFormat:ee,__stopPropagation:T,__onControlClick:n,__onControlMouseEnter:m,__onControlKeyDown:(C,I)=>ft({levelIndex:A,rowIndex:I.rowIndex,cellIndex:I.cellIndex,event:C,controlsRef:q}),__getControlRef:(C,I,se)=>{Array.isArray(q.current[A])||(q.current[A]=[]),Array.isArray(q.current[A][C])||(q.current[A][C]=[]),q.current[A][C][I]=se},levelControlAriaLabel:typeof O=="function"?O(V):O,locale:o,minDate:i,maxDate:l,__preventFocus:y,nextIcon:x,previousIcon:h,nextLabel:c,previousLabel:j,onNext:g,onPrevious:S,onLevelClick:b,nextDisabled:M,previousDisabled:$,hasNextLevel:w,getMonthControlProps:f,classNames:D,styles:E,unstyled:k,__staticSelector:F||"YearLevelGroup",withCellSpacing:v},A)});return e.jsx(as,{classNames:D,styles:E,__staticSelector:F||"YearLevelGroup",ref:s,size:X,unstyled:k,...N,children:_})});Gs.classes={...Hs.classes,...as.classes};Gs.displayName="@mantine/dates/YearLevelGroup";const Ao={numberOfColumns:1},Ws=Ce((t,s)=>{const a=xe("MonthLevelGroup",Ao,t),{month:r,locale:o,firstDayOfWeek:i,weekdayFormat:l,weekendDays:u,getDayProps:f,excludeDate:n,minDate:m,maxDate:v,renderDay:y,hideOutsideDates:x,hideWeekdays:h,getDayAriaLabel:c,__onDayClick:j,__onDayMouseEnter:g,withCellSpacing:S,highlightToday:b,withWeekNumbers:M,__preventFocus:$,nextIcon:w,previousIcon:D,nextLabel:E,previousLabel:k,onNext:F,onPrevious:T,onLevelClick:H,nextDisabled:O,previousDisabled:ee,hasNextLevel:X,classNames:W,styles:N,unstyled:q,numberOfColumns:_,levelControlAriaLabel:U,monthLabelFormat:A,__staticSelector:V,__stopPropagation:C,size:I,static:se,vars:oe,...ue}=a,ce=p.useRef([]),te=Array(_).fill(0).map((ye,Q)=>{const me=L(r).add(Q,"months").toDate();return e.jsx(Bs,{month:me,withNext:Q===_-1,withPrevious:Q===0,monthLabelFormat:A,__stopPropagation:C,__onDayClick:j,__onDayMouseEnter:g,__onDayKeyDown:(re,Se)=>ft({levelIndex:Q,rowIndex:Se.rowIndex,cellIndex:Se.cellIndex,event:re,controlsRef:ce}),__getDayRef:(re,Se,ge)=>{Array.isArray(ce.current[Q])||(ce.current[Q]=[]),Array.isArray(ce.current[Q][re])||(ce.current[Q][re]=[]),ce.current[Q][re][Se]=ge},levelControlAriaLabel:typeof U=="function"?U(me):U,locale:o,firstDayOfWeek:i,weekdayFormat:l,weekendDays:u,getDayProps:f,excludeDate:n,minDate:m,maxDate:v,renderDay:y,hideOutsideDates:x,hideWeekdays:h,getDayAriaLabel:c,__preventFocus:$,nextIcon:w,previousIcon:D,nextLabel:E,previousLabel:k,onNext:F,onPrevious:T,onLevelClick:H,nextDisabled:O,previousDisabled:ee,hasNextLevel:X,classNames:W,styles:N,unstyled:q,__staticSelector:V||"MonthLevelGroup",size:I,static:se,withCellSpacing:S,highlightToday:b,withWeekNumbers:M},Q)});return e.jsx(as,{classNames:W,styles:N,__staticSelector:V||"MonthLevelGroup",ref:s,size:I,...ue,children:te})});Ws.classes={...as.classes,...Bs.classes};Ws.displayName="@mantine/dates/MonthLevelGroup";var Ca={input:"m_6fa5e2aa"};const No={},Us=Ce((t,s)=>{const{inputProps:a,wrapperProps:r,placeholder:o,classNames:i,styles:l,unstyled:u,popoverProps:f,modalProps:n,dropdownType:m,children:v,formattedValue:y,dropdownHandlers:x,dropdownOpened:h,onClick:c,clearable:j,onClear:g,clearButtonProps:S,rightSection:b,shouldClear:M,readOnly:$,disabled:w,value:D,name:E,form:k,type:F,...T}=Ht("PickerInputBase",No,t),H=e.jsx(We.ClearButton,{onClick:g,unstyled:u,...S}),O=()=>{F==="range"&&Array.isArray(D)&&D[0]&&!D[1]&&g(),x.close()};return e.jsxs(e.Fragment,{children:[m==="modal"&&!$&&e.jsx(Ps,{opened:h,onClose:O,withCloseButton:!1,size:"auto","data-dates-modal":!0,unstyled:u,...n,children:v}),e.jsx(We.Wrapper,{...r,children:e.jsxs(us,{position:"bottom-start",opened:h,trapFocus:!0,returnFocus:!1,unstyled:u,...f,disabled:(f==null?void 0:f.disabled)||m==="modal"||$,onChange:ee=>{var X;ee||((X=f==null?void 0:f.onClose)==null||X.call(f),O())},children:[e.jsx(us.Target,{children:e.jsx(We,{"data-dates-input":!0,"data-read-only":$||void 0,disabled:w,component:"button",type:"button",multiline:!0,onClick:ee=>{c==null||c(ee),x.toggle()},__clearSection:H,__clearable:j&&M&&!$&&!w,rightSection:b,...a,ref:s,classNames:{...i,input:Aa(Ca.input,i==null?void 0:i.input)},...T,children:y||e.jsx(We.Placeholder,{error:a.error,unstyled:u,className:i==null?void 0:i.placeholder,style:l==null?void 0:l.placeholder,children:o})})}),e.jsx(us.Dropdown,{"data-dates-dropdown":!0,children:v})]})}),e.jsx(ia,{value:D,name:E,form:k,type:F})]})});Us.classes=Ca;Us.displayName="@mantine/dates/PickerInputBase";const zt=t=>t==="range"?[null,null]:t==="multiple"?[]:null;function xt({type:t,value:s,defaultValue:a,onChange:r,applyTimezone:o=!0}){const i=p.useRef(t),l=Ve(),[u,f,n]=ms({value:Qe("add",s,l.getTimezone(),!o),defaultValue:Qe("add",a,l.getTimezone(),!o),finalValue:zt(t),onChange:v=>{r==null||r(Qe("remove",v,l.getTimezone(),!o))}});let m=u;return i.current!==t&&(i.current=t,s===void 0&&(m=a!==void 0?a:zt(t),f(m))),[m,f,n]}function et(t,s){return t?t==="month"?0:t==="year"?1:2:s||0}function Io(t){return t===0?"month":t===1?"year":"decade"}function vs(t,s,a){return Io(Cs(et(t,0),et(s,0),et(a,2)))}const Ro={maxLevel:"decade",minLevel:"month",__updateDateOnYearSelect:!0,__updateDateOnMonthSelect:!0},Ks=Ce((t,s)=>{const a=xe("Calendar",Ro,t),{vars:r,maxLevel:o,minLevel:i,defaultLevel:l,level:u,onLevelChange:f,date:n,defaultDate:m,onDateChange:v,numberOfColumns:y,columnsToScroll:x,ariaLabels:h,nextLabel:c,previousLabel:j,onYearSelect:g,onMonthSelect:S,onYearMouseEnter:b,onMonthMouseEnter:M,__updateDateOnYearSelect:$,__updateDateOnMonthSelect:w,firstDayOfWeek:D,weekdayFormat:E,weekendDays:k,getDayProps:F,excludeDate:T,renderDay:H,hideOutsideDates:O,hideWeekdays:ee,getDayAriaLabel:X,monthLabelFormat:W,nextIcon:N,previousIcon:q,__onDayClick:_,__onDayMouseEnter:U,withCellSpacing:A,highlightToday:V,withWeekNumbers:C,monthsListFormat:I,getMonthControlProps:se,yearLabelFormat:oe,yearsListFormat:ue,getYearControlProps:ce,decadeLabelFormat:te,classNames:ye,styles:Q,unstyled:me,minDate:re,maxDate:Se,locale:ge,__staticSelector:je,size:P,__preventFocus:le,__stopPropagation:J,onNextDecade:fe,onPreviousDecade:_e,onNextYear:De,onPreviousYear:ze,onNextMonth:R,onPreviousMonth:K,static:de,__timezoneApplied:pe,...Ne}=a,{resolvedClassNames:Re,resolvedStyles:d}=ks({classNames:ye,styles:Q,props:a}),[z,G]=ms({value:u?vs(u,i,o):void 0,defaultValue:l?vs(l,i,o):void 0,finalValue:vs(void 0,i,o),onChange:f}),[he,Z]=xt({type:"default",value:n,defaultValue:m,onChange:v,applyTimezone:!pe}),Y={__staticSelector:je||"Calendar",styles:d,classNames:Re,unstyled:me,size:P},ae=Ve(),ve=x||y||1,ke=new Date,He=re&&re>ke?re:ke,Ee=he||Qe("add",He,ae.getTimezone()),Ge=()=>{const Me=L(Ee).add(ve,"month").toDate();R==null||R(Me),Z(Me)},Xe=()=>{const Me=L(Ee).subtract(ve,"month").toDate();K==null||K(Me),Z(Me)},es=()=>{const Me=L(Ee).add(ve,"year").toDate();De==null||De(Me),Z(Me)},ps=()=>{const Me=L(Ee).subtract(ve,"year").toDate();ze==null||ze(Me),Z(Me)},Sa=()=>{const Me=L(Ee).add(10*ve,"year").toDate();fe==null||fe(Me),Z(Me)},_a=()=>{const Me=L(Ee).subtract(10*ve,"year").toDate();_e==null||_e(Me),Z(Me)};return e.jsxs(ie,{ref:s,size:P,"data-calendar":!0,...Ne,children:[z==="month"&&e.jsx(Ws,{month:Ee,minDate:re,maxDate:Se,firstDayOfWeek:D,weekdayFormat:E,weekendDays:k,getDayProps:F,excludeDate:T,renderDay:H,hideOutsideDates:O,hideWeekdays:ee,getDayAriaLabel:X,onNext:Ge,onPrevious:Xe,hasNextLevel:o!=="month",onLevelClick:()=>G("year"),numberOfColumns:y,locale:ge,levelControlAriaLabel:h==null?void 0:h.monthLevelControl,nextLabel:(h==null?void 0:h.nextMonth)??c,nextIcon:N,previousLabel:(h==null?void 0:h.previousMonth)??j,previousIcon:q,monthLabelFormat:W,__onDayClick:_,__onDayMouseEnter:U,__preventFocus:le,__stopPropagation:J,static:de,withCellSpacing:A,highlightToday:V,withWeekNumbers:C,...Y}),z==="year"&&e.jsx(Gs,{year:Ee,numberOfColumns:y,minDate:re,maxDate:Se,monthsListFormat:I,getMonthControlProps:se,locale:ge,onNext:es,onPrevious:ps,hasNextLevel:o!=="month"&&o!=="year",onLevelClick:()=>G("decade"),levelControlAriaLabel:h==null?void 0:h.yearLevelControl,nextLabel:(h==null?void 0:h.nextYear)??c,nextIcon:N,previousLabel:(h==null?void 0:h.previousYear)??j,previousIcon:q,yearLabelFormat:oe,__onControlMouseEnter:M,__onControlClick:(Me,fs)=>{w&&Z(fs),G(vs("month",i,o)),S==null||S(fs)},__preventFocus:le,__stopPropagation:J,withCellSpacing:A,...Y}),z==="decade"&&e.jsx(qs,{decade:Ee,minDate:re,maxDate:Se,yearsListFormat:ue,getYearControlProps:ce,locale:ge,onNext:Sa,onPrevious:_a,numberOfColumns:y,nextLabel:(h==null?void 0:h.nextDecade)??c,nextIcon:N,previousLabel:(h==null?void 0:h.previousDecade)??j,previousIcon:q,decadeLabelFormat:te,__onControlMouseEnter:b,__onControlClick:(Me,fs)=>{$&&Z(fs),G(vs("year",i,o)),g==null||g(fs)},__preventFocus:le,__stopPropagation:J,withCellSpacing:A,...Y})]})});Ks.classes={...qs.classes,...Gs.classes,...Ws.classes};Ks.displayName="@mantine/dates/Calendar";function Po(t){const{maxLevel:s,minLevel:a,defaultLevel:r,level:o,onLevelChange:i,nextIcon:l,previousIcon:u,date:f,defaultDate:n,onDateChange:m,numberOfColumns:v,columnsToScroll:y,ariaLabels:x,nextLabel:h,previousLabel:c,onYearSelect:j,onMonthSelect:g,onYearMouseEnter:S,onMonthMouseEnter:b,onNextMonth:M,onPreviousMonth:$,onNextYear:w,onPreviousYear:D,onNextDecade:E,onPreviousDecade:k,withCellSpacing:F,highlightToday:T,__updateDateOnYearSelect:H,__updateDateOnMonthSelect:O,withWeekNumbers:ee,firstDayOfWeek:X,weekdayFormat:W,weekendDays:N,getDayProps:q,excludeDate:_,renderDay:U,hideOutsideDates:A,hideWeekdays:V,getDayAriaLabel:C,monthLabelFormat:I,monthsListFormat:se,getMonthControlProps:oe,yearLabelFormat:ue,yearsListFormat:ce,getYearControlProps:te,decadeLabelFormat:ye,allowSingleDateInRange:Q,allowDeselect:me,minDate:re,maxDate:Se,locale:ge,...je}=t;return{calendarProps:{maxLevel:s,minLevel:a,defaultLevel:r,level:o,onLevelChange:i,nextIcon:l,previousIcon:u,date:f,defaultDate:n,onDateChange:m,numberOfColumns:v,columnsToScroll:y,ariaLabels:x,nextLabel:h,previousLabel:c,onYearSelect:j,onMonthSelect:g,onYearMouseEnter:S,onMonthMouseEnter:b,onNextMonth:M,onPreviousMonth:$,onNextYear:w,onPreviousYear:D,onNextDecade:E,onPreviousDecade:k,withCellSpacing:F,highlightToday:T,__updateDateOnYearSelect:H,__updateDateOnMonthSelect:O,withWeekNumbers:ee,firstDayOfWeek:X,weekdayFormat:W,weekendDays:N,getDayProps:q,excludeDate:_,renderDay:U,hideOutsideDates:A,hideWeekdays:V,getDayAriaLabel:C,monthLabelFormat:I,monthsListFormat:se,getMonthControlProps:oe,yearLabelFormat:ue,yearsListFormat:ce,getYearControlProps:te,decadeLabelFormat:ye,allowSingleDateInRange:Q,allowDeselect:me,minDate:re,maxDate:Se,locale:ge},others:je}}function At(t,s){const a=[...s].sort((r,o)=>r.getTime()-o.getTime());return L(a[0]).startOf("day").subtract(1,"ms").isBefore(t)&&L(a[1]).endOf("day").add(1,"ms").isAfter(t)}function To({type:t,level:s,value:a,defaultValue:r,onChange:o,allowSingleDateInRange:i,allowDeselect:l,onMouseLeave:u,applyTimezone:f=!0}){const[n,m]=xt({type:t,value:a,defaultValue:r,onChange:o,applyTimezone:f}),[v,y]=p.useState(t==="range"&&n[0]&&!n[1]?n[0]:null),[x,h]=p.useState(null),c=w=>{if(t==="range"){if(v instanceof Date&&!n[1]){if(L(w).isSame(v,s)&&!i){y(null),h(null),m([null,null]);return}const D=[w,v];D.sort((E,k)=>E.getTime()-k.getTime()),m(D),h(null),y(null);return}if(n[0]&&!n[1]&&L(w).isSame(n[0],s)&&!i){y(null),h(null),m([null,null]);return}m([w,null]),h(null),y(w);return}if(t==="multiple"){n.some(D=>L(D).isSame(w,s))?m(n.filter(D=>!L(D).isSame(w,s))):m([...n,w]);return}n&&l&&L(w).isSame(n,s)?m(null):m(w)},j=w=>v instanceof Date&&x instanceof Date?At(w,[x,v]):n[0]instanceof Date&&n[1]instanceof Date?At(w,n):!1,g=t==="range"?w=>{u==null||u(w),h(null)}:u,S=w=>n[0]instanceof Date&&L(w).isSame(n[0],s)?!(x&&L(x).isBefore(n[0])):!1,b=w=>n[1]instanceof Date?L(w).isSame(n[1],s):!(n[0]instanceof Date)||!x?!1:L(x).isBefore(n[0])&&L(w).isSame(n[0],s),M=w=>{if(t==="range")return{selected:n.some(E=>E&&L(E).isSame(w,s)),inRange:j(w),firstInRange:S(w),lastInRange:b(w),"data-autofocus":!!n[0]&&L(n[0]).isSame(w,s)||void 0};if(t==="multiple")return{selected:n.some(E=>E&&L(E).isSame(w,s)),"data-autofocus":!!n[0]&&L(n[0]).isSame(w,s)||void 0};const D=L(n).isSame(w,s);return{selected:D,"data-autofocus":D||void 0}},$=t==="range"&&v?h:()=>{};return p.useEffect(()=>{if(t==="range")if(n[0]&&!n[1]&&(v==null?void 0:v.getTime())!==n[0].getTime())y(n[0]);else{const w=n[0]==null&&n[1]==null,D=n[0]!=null&&n[1]!=null;(w||D)&&(y(null),h(null))}},[n]),{onDateChange:c,onRootMouseLeave:g,onHoveredDateChange:$,getControlProps:M,_value:n,setValue:m}}const Fo={type:"default",defaultLevel:"month",numberOfColumns:1},Zs=Ce((t,s)=>{const a=xe("DatePicker",Fo,t),{classNames:r,styles:o,vars:i,type:l,defaultValue:u,value:f,onChange:n,__staticSelector:m,getDayProps:v,allowSingleDateInRange:y,allowDeselect:x,onMouseLeave:h,numberOfColumns:c,hideOutsideDates:j,__onDayMouseEnter:g,__onDayClick:S,__timezoneApplied:b,...M}=a,{onDateChange:$,onRootMouseLeave:w,onHoveredDateChange:D,getControlProps:E}=To({type:l,level:"day",allowDeselect:x,allowSingleDateInRange:y,value:f,defaultValue:u,onChange:n,onMouseLeave:h,applyTimezone:!b}),{resolvedClassNames:k,resolvedStyles:F}=ks({classNames:r,styles:o,props:a}),T=Ve();return e.jsx(Ks,{ref:s,minLevel:"month",classNames:k,styles:F,__staticSelector:m||"DatePicker",onMouseLeave:w,numberOfColumns:c,hideOutsideDates:j??c!==1,__onDayMouseEnter:(H,O)=>{D(O),g==null||g(H,O)},__onDayClick:(H,O)=>{$(O),S==null||S(H,O)},getDayProps:H=>({...E(H),...v==null?void 0:v(H)}),...M,date:Qe("add",M.date,T.getTimezone(),b),__timezoneApplied:!0})});Zs.classes=Ks.classes;Zs.displayName="@mantine/dates/DatePicker";function Oo({type:t,value:s,defaultValue:a,onChange:r,locale:o,format:i,closeOnChange:l,sortDates:u,labelSeparator:f,valueFormatter:n}){const m=Ve(),[v,y]=Bt(!1),[x,h]=xt({type:t,value:s,defaultValue:a,onChange:r}),c=Hr({type:t,date:x,locale:m.getLocale(o),format:i,labelSeparator:m.getLabelSeparator(f),formatter:n}),j=b=>{l&&(t==="default"&&y.close(),t==="range"&&b[0]&&b[1]&&y.close()),h(u&&t==="multiple"?[...b].sort((M,$)=>M.getTime()-$.getTime()):b)},g=()=>j(t==="range"?[null,null]:t==="multiple"?[]:null),S=t==="range"?!!x[0]:t==="multiple"?x.length>0:x!==null;return{_value:x,setValue:j,onClear:g,shouldClear:S,formattedValue:c,dropdownOpened:v,dropdownHandlers:y}}const Vo={type:"default",valueFormat:"MMMM D, YYYY",closeOnChange:!0,sortDates:!0,dropdownType:"popover"},Rs=Ce((t,s)=>{const a=xe("DatePickerInput",Vo,t),{type:r,value:o,defaultValue:i,onChange:l,valueFormat:u,labelSeparator:f,locale:n,classNames:m,styles:v,unstyled:y,closeOnChange:x,size:h,variant:c,dropdownType:j,sortDates:g,minDate:S,maxDate:b,vars:M,defaultDate:$,valueFormatter:w,...D}=a,{resolvedClassNames:E,resolvedStyles:k}=ks({classNames:m,styles:v,props:a}),{calendarProps:F,others:T}=Po(D),{_value:H,setValue:O,formattedValue:ee,dropdownHandlers:X,dropdownOpened:W,onClear:N,shouldClear:q}=Oo({type:r,value:o,defaultValue:i,onChange:l,locale:n,format:u,labelSeparator:f,closeOnChange:x,sortDates:g,valueFormatter:w}),_=Array.isArray(H)?H[0]||$:H||$,U=Ve();return e.jsx(Us,{formattedValue:ee,dropdownOpened:W,dropdownHandlers:X,classNames:E,styles:k,unstyled:y,ref:s,onClear:N,shouldClear:q,value:H,size:h,variant:c,dropdownType:j,...T,type:r,__staticSelector:"DatePickerInput",children:e.jsx(Zs,{...F,size:h,variant:c,type:r,value:H,defaultDate:_||Jr({maxDate:b,minDate:S,timezone:U.getTimezone()}),onChange:O,locale:n,classNames:E,styles:k,unstyled:y,__staticSelector:"DatePickerInput",__stopPropagation:j==="popover",minDate:S,maxDate:b,date:Qe("add",F.date,U.getTimezone()),__timezoneApplied:!0})})});Rs.classes={...Us.classes,...Zs.classes};Rs.displayName="@mantine/dates/DatePickerInput";function Yo(t){if(!t)return"-";const s=[];return t.fechaInicio&&t.fechaFin?s.push(`Fechas: ${L(t.fechaInicio).format("DD/MM/YY")}-${L(t.fechaFin).format("DD/MM/YY")}`):t.fechaInicio?s.push(`Desde: ${L(t.fechaInicio).format("DD/MM/YY")}`):t.fechaFin&&s.push(`Hasta: ${L(t.fechaFin).format("DD/MM/YY")}`),t.timeFrom&&t.timeTo?s.push(`Hora: ${t.timeFrom}-${t.timeTo}`):t.timeFrom?s.push(`Desde H: ${t.timeFrom}`):t.timeTo&&s.push(`Hasta H: ${t.timeTo}`),t.selectedLectores&&t.selectedLectores.length>0&&s.push(`Lectores: ${t.selectedLectores.length}`),t.selectedCarreteras&&t.selectedCarreteras.length>0&&s.push(`Carreteras: ${t.selectedCarreteras.length}`),t.matricula&&s.push(`Matrícula: ${t.matricula}`),t.selectedSentidos&&t.selectedSentidos.length>0&&s.push(`Sentidos: ${t.selectedSentidos.join(", ")}`),t.minPasos!==null&&t.minPasos!==void 0&&s.push(`MinPasos: ${t.minPasos}`),t.maxPasos!==null&&t.maxPasos!==void 0&&s.push(`MaxPasos: ${t.maxPasos}`),s.length>0?s.join(" | "):"Sin filtros específicos"}const Nt={fechaInicio:null,fechaFin:null,timeFrom:"",timeTo:"",selectedLectores:[],selectedCarreteras:[],matricula:"",selectedSentidos:[],minPasos:null,maxPasos:null},Ho=[{value:"Creciente",label:"Creciente"},{value:"Decreciente",label:"Decreciente"}],Bo=`
  /* Estilos tabla resultados */
  .results-datatable th:first-child,
  .results-datatable td:first-child {
    width: 50px !important; 
    min-width: 50px !important;
    max-width: 50px !important;
    padding-left: var(--mantine-spacing-xs) !important; 
    padding-right: var(--mantine-spacing-xs) !important;
  }

  /* Estilos resaltado */
  .highlighted-row {
    background-color: var(--mantine-color-blue-0) !important; 
  }
  .highlighted-row:hover {
      background-color: var(--mantine-color-blue-1) !important; 
  }

  /* Estilos DatePicker LPR Avanzado */
  .lpr-avanzado-datepicker-wrapper .mantine-InputWrapper-label {
      display: block !important; 
      margin-bottom: var(--mantine-spacing-xs);
  }

  /* NUEVO: Forzar ancho columna selección Tabla Búsquedas Guardadas */
  .saved-searches-datatable th:first-child,
  .saved-searches-datatable td:first-child {
      width: 50px !important; /* Ancho fijo muy reducido */
      min-width: 50px !important;
      max-width: 50px !important;
      padding-left: var(--mantine-spacing-xs) !important; /* Ajustar padding si es necesario */
      padding-right: var(--mantine-spacing-xs) !important;
  }
`;function qo({casoId:t,interactedMatriculas:s,addInteractedMatricula:a}){const r={width:Pe(16),height:Pe(16)},[o,i]=p.useState(Nt),[l,u]=p.useState([]),[f,n]=p.useState([]),[m,v]=p.useState([]),[y,x]=p.useState([]),[h,c]=p.useState([]),[j,g]=p.useState(!1),[S,b]=p.useState(!1),[M,$]=p.useState(!0),[w,D]=p.useState(1),E=15,[k,F]=p.useState({columnAccessor:"matricula",direction:"asc"}),[T,H]=p.useState([]),[O,ee]=p.useState([]),[X,W]=p.useState([]),[N,q]=p.useState(!1),[_,{open:U,close:A}]=Bt(!1),[V,C]=p.useState(null),[I,se]=p.useState(!1),oe=sr({initialValues:{nombre:"",color:"",notas:""},validate:{nombre:d=>d.trim().length>0?null:"El nombre es obligatorio"}});p.useEffect(()=>{t?(async()=>{$(!0),u([]),n([]);try{console.log(`LprAvanzado: Fetching filtros disponibles para caso ${t}...`);const z=await fetch(`http://localhost:8000/casos/${t}/filtros_disponibles`);if(!z.ok)throw new Error(`Filtros: ${z.statusText||z.status}`);const G=await z.json();if(G&&G.lectores&&G.carreteras)u(G.lectores),n(G.carreteras),console.log(`LprAvanzado: Filtros cargados - ${G.lectores.length} lectores, ${G.carreteras.length} carreteras.`);else throw new Error("Formato inesperado de respuesta para filtros disponibles")}catch(z){console.error("LprAvanzado: Error fetching filtros disponibles:",z),B.show({title:"Error",message:"No se pudieron cargar las opciones de filtro para este caso.",color:"red"})}finally{$(!1)}})():($(!1),console.error("LprAvanzadoPanel: casoId no proporcionado."),B.show({title:"Error",message:"ID de caso no disponible para cargar filtros.",color:"red"}))},[t]);const ue=async()=>{if(t){g(!0);try{const d=await fetch(`http://localhost:8000/casos/${t}/saved_searches`);if(!d.ok)throw new Error(`Error cargando búsquedas: ${d.statusText||d.status}`);const z=await d.json();H(z)}catch(d){console.error("Error fetching saved searches:",d),B.show({title:"Error",message:`No se pudieron cargar las búsquedas guardadas: ${d instanceof Error?d.message:"Error desconocido"}`,color:"red"})}finally{g(!1)}}};p.useEffect(()=>{ue()},[t]),p.useEffect(()=>{J(X)},[X]);const ce=Na.useMemo(()=>os.orderBy(m,[k.columnAccessor],[k.direction]).slice((w-1)*E,w*E),[m,k,w,E]),te=(d,z)=>{i(G=>({...G,[d]:z}))},ye=()=>{const d={...o};return o.fechaInicio?d.fechaInicio=L(o.fechaInicio).format("YYYY-MM-DD"):delete d.fechaInicio,o.fechaFin?d.fechaFin=L(o.fechaFin).format("YYYY-MM-DD"):delete d.fechaFin,d.timeFrom||delete d.timeFrom,d.timeTo||delete d.timeTo,d.matricula.trim()?d.matricula=d.matricula.trim():delete d.matricula,d.selectedSentidos&&d.selectedSentidos.length>0||delete d.selectedSentidos,delete d.minPasos,delete d.maxPasos,d},Q=async d=>{g(!0),v([]),W([]),x([]),D(1);const z=new URLSearchParams;z.append("limit","20000"),z.append("caso_ids",String(t)),z.append("tipo_fuente","LPR"),d.fechaInicio&&z.append("fecha_inicio",d.fechaInicio),d.fechaFin&&z.append("fecha_fin",d.fechaFin),d.timeFrom&&z.append("hora_inicio",d.timeFrom),d.timeTo&&z.append("hora_fin",d.timeTo),(d.selectedLectores||[]).forEach(Z=>z.append("lector_ids",Z)),(d.selectedCarreteras||[]).forEach(Z=>z.append("carretera_ids",Z)),d.matricula&&z.append("matricula",d.matricula),(d.selectedSentidos||[]).forEach(Z=>z.append("sentido",Z));const he=`http://localhost:8000/lecturas?${z.toString()}`;console.log("Ejecutando búsqueda directa:",he);try{const Z=await fetch(he);if(!Z.ok)throw new Error("Error en la búsqueda");const Y=await Z.json();if(Y.length>0){const ae=os.groupBy(Y,"Matricula"),ve=Object.entries(ae).map(([Ge,Xe])=>{const es=os.sortBy(Xe,ps=>new Date(ps.Fecha_y_Hora));return{matricula:Ge,count:Xe.length,firstSeen:L(es[0].Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss"),lastSeen:L(es[es.length-1].Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss"),readings:es}}),ke=o.minPasos,He=o.maxPasos;let Ee=ve;(ke!==null||He!==null)&&(console.info(`Aplicando filtro de Pasos: Min=${ke}, Max=${He}`),Ee=ve.filter(Ge=>{const Xe=Ge.count,es=ke===null||Xe>=ke,ps=He===null||Xe<=He;return es&&ps}),console.info(`Resultados tras filtro Pasos: ${Ee.length}`)),v(Ee),B.show({title:"Búsqueda Ejecutada",message:`Se encontraron ${Ee.length} matrículas únicas.`,color:"blue"})}else v([]),B.show({title:"Búsqueda Ejecutada",message:"No se encontraron resultados.",color:"orange"})}catch(Z){console.error("Error ejecutando búsqueda directa:",Z),B.show({title:"Error en Búsqueda",message:`${Z instanceof Error?Z.message:String(Z)}`,color:"red"}),v([])}finally{g(!1)}},me=()=>{const d=ye();Q(d)},re=async()=>{const d=prompt("Introduce un nombre para esta búsqueda:");if(!d||!d.trim()){B.show({title:"Cancelado",message:"No se guardó la búsqueda.",color:"gray"});return}const z=ye(),G={nombre:d.trim(),filtros:z,color:null,notas:null};g(!0),console.log("Guardando búsqueda:",G);try{const he=await fetch(`http://localhost:8000/casos/${t}/saved_searches`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)});if(!he.ok)throw new Error("No se pudo guardar la búsqueda.");const Z=await he.json();B.show({title:"Búsqueda Guardada",message:`Búsqueda "${Z.nombre}" guardada con éxito.`,color:"green"}),ue()}catch(he){console.error("Error guardando búsqueda:",he),B.show({title:"Error al Guardar",message:`${he instanceof Error?he.message:String(he)}`,color:"red"})}finally{g(!1)}},Se=async d=>{if(confirm(`¿Seguro que quieres eliminar la búsqueda guardada ID ${d}?`)){g(!0);try{const z=await fetch(`http://localhost:8000/saved_searches/${d}`,{method:"DELETE"});if(!z.ok)throw new Error(`Error eliminando búsqueda: ${z.statusText||z.status}`);B.show({title:"Éxito",message:`Búsqueda ${d} eliminada.`,color:"green"}),ue(),ee(G=>G.filter(he=>he!==d))}catch(z){B.show({title:"Error",message:`No se pudo eliminar la búsqueda: ${z instanceof Error?z.message:"Error desconocido"}`,color:"red"})}finally{g(!1)}}},ge=d=>{C(d),oe.setValues({nombre:d.nombre,color:d.color||"",notas:d.notas||""}),U()},je=async d=>{if(!V)return;const z={nombre:d.nombre.trim(),color:d.color||null,notas:d.notas.trim()||null};se(!0),console.log("Enviando actualización para",V.id,z);try{await qa(V.id,z),B.show({title:"Actualización Exitosa",message:`Búsqueda "${z.nombre}" actualizada.`,color:"green",icon:e.jsx(Js,{size:18})}),A(),ue()}catch(G){console.error("Error actualizando búsqueda guardada:",G),B.show({title:"Error al Actualizar",message:`No se pudo guardar los cambios: ${G instanceof Error?G.message:"Error desconocido"}`,color:"red"})}finally{se(!1)}},P=()=>{O.length!==0&&(console.info(`Cargando búsquedas seleccionadas como activas: ${O.join(", ")}`),W([...O]),B.show({title:"Búsquedas Cargadas para Cruce",message:`${O.length} búsqueda(s) lista(s) para cruzar.`,color:"blue"}))},le=()=>{i(Nt),B.show({title:"Filtros Limpiados",message:"Se han restablecido los valores por defecto.",color:"blue"})},J=async d=>{if(g(!0),v([]),d.length===0){g(!1);return}console.info(`Iniciando cruce REAL para búsquedas activas IDs: ${d.join(", ")}`);const z=T.filter(Y=>d.includes(Y.id));if(z.length!==d.length){console.error("Discrepancia entre activeSearchIds y savedSearches encontrados."),B.show({title:"Error en Cruce",message:"Algunas búsquedas activas no se encontraron.",color:"red"}),g(!1);return}const G=[];for(const Y of z)if(Y.unique_plates&&Y.unique_plates.length>0)G.push(Y.unique_plates);else if(Y.result_count===0){console.info(`La búsqueda ${Y.nombre} (${Y.id}) tiene 0 resultados. La intersección será vacía.`),g(!1),B.show({title:"Cruce Vacío",message:`Una de las búsquedas (${Y.nombre}) no tiene resultados.`,color:"orange"});return}else{console.warn(`La búsqueda ${Y.nombre} (${Y.id}) no tiene la lista unique_plates precalculada.`),B.show({title:"Error en Cruce",message:`Faltan datos precalculados para la búsqueda ${Y.nombre}. Vuelve a guardarla.`,color:"red"}),g(!1);return}if(G.length===0){console.info("No hay listas de matrículas válidas para cruzar."),g(!1);return}let he=new Set(G[0]);for(let Y=1;Y<G.length;Y++){const ae=new Set(G[Y]);he=new Set([...he].filter(ve=>ae.has(ve)))}const Z=Array.from(he);if(console.info(`Intersección calculada: ${Z.length} matrículas comunes.`),Z.length===0){B.show({title:"Cruce Completado",message:"No se encontraron matrículas comunes entre las búsquedas seleccionadas.",color:"orange"}),g(!1);return}B.show({id:`loading-intersection-${d.join("-")}`,title:"Calculando Cruce",message:`Buscando lecturas para ${Z.length} matrículas comunes...`,color:"blue",loading:!0,autoClose:!1});try{const Y=await fetch("http://localhost:8000/lecturas/por_matriculas_y_filtros_combinados",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matriculas:Z,caso_id:t,tipo_fuente:"LPR"})});if(!Y.ok){const ve=await Y.json().catch(()=>({detail:"Error desconocido en la API"}));throw new Error(ve.detail||`Error HTTP ${Y.status}`)}const ae=await Y.json();if(ae.length>0){const ve=os.groupBy(ae,"Matricula"),ke=Object.entries(ve).map(([He,Ee])=>{const Ge=os.sortBy(Ee,Xe=>new Date(Xe.Fecha_y_Hora));return{matricula:He,count:Ee.length,firstSeen:L(Ge[0].Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss"),lastSeen:L(Ge[Ge.length-1].Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss"),readings:Ge}});v(ke),B.update({id:`loading-intersection-${d.join("-")}`,title:"Cruce Completado",message:`Mostrando ${ke.length} matrículas comunes y sus ${ae.length} lecturas.`,color:"green",icon:e.jsx(Js,{size:18}),loading:!1,autoClose:5e3})}else v([]),B.update({id:`loading-intersection-${d.join("-")}`,title:"Cruce Extraño",message:"Se encontraron matrículas comunes pero no sus lecturas.",color:"orange",loading:!1,autoClose:5e3})}catch(Y){console.error("Error al obtener lecturas para la intersección:",Y),B.update({id:`loading-intersection-${d.join("-")}`,title:"Error en Cruce",message:`No se pudieron obtener las lecturas detalladas: ${Y instanceof Error?Y.message:String(Y)}`,color:"red",loading:!1,autoClose:5e3}),v([])}finally{g(!1)}},fe=async()=>{const d=[...O];if(d.length===0||!window.confirm(`¿Estás seguro de que quieres eliminar ${d.length} búsqueda(s) guardada(s) seleccionada(s)?`))return;g(!0);let z=0,G=0;(await Promise.allSettled(d.map(Z=>fetch(`http://localhost:8000/saved_searches/${Z}`,{method:"DELETE"}).then(Y=>Y.ok?{id:Z}:Y.json().catch(()=>null).then(ae=>{throw new Error((ae==null?void 0:ae.detail)||`Error ${Y.status}`)}))))).forEach((Z,Y)=>{const ae=d[Y];Z.status==="fulfilled"?(z++,console.info(`Búsqueda ${ae} eliminada con éxito.`)):(G++,console.error(`Error eliminando búsqueda ${ae}:`,Z.reason),B.show({title:"Error Eliminando Búsqueda",message:`No se pudo eliminar ID ${ae}: ${Z.reason.message}`,color:"red"}))}),z>0&&B.show({title:"Eliminación Completada",message:`${z} búsqueda(s) eliminada(s).`+(G>0?` ${G} fallaron.`:""),color:G>0?"orange":"green",icon:e.jsx(Js,{size:18})}),ee([]),ue(),g(!1)},_e=p.useCallback(d=>{const z=d.filter(G=>typeof G=="string");x(z),z.length>0&&a(z)},[a]),De=d=>{D(1),F(d)},ze=p.useCallback(d=>{c(d);const z=d.map(G=>G.matricula);z.length>0&&a(z)},[a]),R=async()=>{if(h.length===0)return;const d=h.flatMap(Z=>{var Y;return((Y=Z.readings)==null?void 0:Y.map(ae=>ae.ID_Lectura).filter(ae=>ae!==void 0))??[]});if(d.length===0){B.show({title:"Aviso",message:"No hay lecturas detalladas para marcar en la selección.",color:"orange"});return}if(!window.confirm(`¿Marcar como relevantes ${d.length} lecturas de ${h.length} matrícula(s) seleccionada(s)?`))return;b(!0);let z=0,G=0;(await Promise.allSettled(d.map(Z=>fetch(`http://localhost:8000/lecturas/${Z}/marcar_relevante`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Nota:null,caso_id:t})}).then(Y=>!Y.ok&&Y.status!==409?Y.json().catch(()=>null).then(ae=>{throw new Error((ae==null?void 0:ae.detail)||`Error ${Y.status}`)}):{id:Z})))).forEach((Z,Y)=>{Z.status==="fulfilled"?z++:(G++,B.show({title:"Error al Marcar",message:`ID ${d[Y]}: ${Z.reason.message}`,color:"red"}))}),z>0&&B.show({title:"Lecturas Marcadas",message:`${z} lecturas marcadas.`+(G>0?` ${G} fallaron.`:""),color:G>0?"orange":"green"}),c([]),b(!1)},K=async()=>{if(h.length===0)return;const d=h.flatMap(Z=>{var Y;return((Y=Z.readings)==null?void 0:Y.map(ae=>ae.ID_Lectura).filter(ae=>ae!==void 0))??[]});if(d.length===0){B.show({title:"Aviso",message:"No hay lecturas detalladas para desmarcar en la selección.",color:"orange"});return}if(!window.confirm(`¿Desmarcar como relevantes ${d.length} lecturas de ${h.length} matrícula(s) seleccionada(s)?`))return;b(!0);let z=0,G=0;(await Promise.allSettled(d.map(Z=>fetch(`http://localhost:8000/lecturas/${Z}/desmarcar_relevante`,{method:"DELETE"}).then(Y=>!Y.ok&&Y.status!==404?Y.json().catch(()=>null).then(ae=>{throw new Error((ae==null?void 0:ae.detail)||`Error ${Y.status}`)}):{id:Z})))).forEach((Z,Y)=>{Z.status==="fulfilled"?z++:(G++,B.show({title:"Error al Desmarcar",message:`ID ${d[Y]}: ${Z.reason.message}`,color:"red"}))}),z>0&&B.show({title:"Lecturas Desmarcadas",message:`${z} lecturas desmarcadas.`+(G>0?` ${G} fallaron.`:""),color:G>0?"orange":"green"}),c([]),b(!1)},de=async()=>{const d=h.map(ae=>ae.matricula);if(d.length===0)return;b(!0);let z=0,G=0,he=0;(await Promise.allSettled(d.map(ae=>fetch("http://localhost:8000/vehiculos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Matricula:ae})}).then(async ve=>{if(ve.status===201)return{status:"created"};if(ve.status===400)return{status:"exists"};const ke=await ve.json().catch(()=>null);throw new Error((ke==null?void 0:ke.detail)||`HTTP ${ve.status}`)})))).forEach(ae=>{ae.status==="fulfilled"?(ae.value.status==="created"&&z++,ae.value.status==="exists"&&G++):(he++,B.show({title:"Error Parcial Guardando Vehículo",message:`${ae.reason.message}`,color:"red"}))});let Y="";z>0&&(Y+=`${z} vehículo(s) nuevo(s) guardado(s). `),G>0&&(Y+=`${G} ya existían. `),he>0&&(Y+=`${he} matrícula(s) no se pudieron procesar.`),Y&&B.show({title:"Guardar Vehículos Completado",message:Y.trim(),color:he>0?z>0?"orange":"red":"green"}),c([]),b(!1)},pe=async d=>{const z=d.unique_plates;if(!z||z.length===0){B.show({title:"No hay Vehículos",message:`La búsqueda "${d.nombre}" no tiene matrículas únicas precalculadas o no produjo resultados.`,color:"orange"});return}if(!window.confirm(`¿Guardar ${z.length} vehículo(s) único(s) de la búsqueda "${d.nombre}" en la tabla general de Vehículos?`))return;g(!0);let G=0,he=0,Z=0;(await Promise.allSettled(z.map(ve=>fetch("http://localhost:8000/vehiculos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Matricula:ve})}).then(async ke=>{if(ke.status===201)return{status:"created"};if(ke.status===400||ke.status===409)return{status:"exists"};const He=await ke.json().catch(()=>null);throw new Error((He==null?void 0:He.detail)||`HTTP ${ke.status}`)})))).forEach(ve=>{ve.status==="fulfilled"?(ve.value.status==="created"&&G++,ve.value.status==="exists"&&he++):(Z++,B.show({title:"Error Parcial Guardando Vehículo",message:`${ve.reason.message}`,color:"red"}))});let ae="";G>0&&(ae+=`${G} vehículo(s) nuevo(s) guardado(s). `),he>0&&(ae+=`${he} ya existían. `),Z>0&&(ae+=`${Z} matrícula(s) no se pudieron procesar.`),ae&&B.show({title:"Guardar Vehículos Completado",message:ae.trim(),color:Z>0?G>0?"orange":"red":"green"}),g(!1)},Ne=[{accessor:"matricula",title:"Matrícula",sortable:!0,width:100},{accessor:"count",title:"Nº Pasos",textAlign:"right",sortable:!0,width:70},{accessor:"firstSeen",title:"Primera Vez",sortable:!0,width:150},{accessor:"lastSeen",title:"Última Vez",sortable:!0,width:150}],Re=[{accessor:"nombre",title:"Nombre Búsqueda",width:150,sortable:!0},{accessor:"filtros",title:"Parámetros del Filtro",width:200,render:({filtros:d})=>{const z=Yo(d);return e.jsx($e,{label:z,multiline:!0,w:300,position:"top-start",openDelay:500,children:e.jsx(ne,{size:"xs",truncate:"end",children:z})})}},{accessor:"color",title:"Color",width:60,render:({color:d})=>d?e.jsx(ie,{bg:d,w:20,h:20,style:{borderRadius:"50%",margin:"auto"}}):null},{accessor:"notas",title:"Notas",width:300,render:({notas:d})=>d?e.jsx($e,{label:d,multiline:!0,w:200,children:e.jsx(ne,{truncate:"end",size:"xs",children:d})}):"-"},{accessor:"result_count",title:"Nº Matr.",textAlign:"right",width:80,sortable:!0,render:({result_count:d})=>d??"-"},{accessor:"actions",title:"Acciones",width:100,textAlign:"center",render:d=>e.jsxs(we,{gap:"xs",justify:"center",wrap:"nowrap",children:[e.jsx($e,{label:"Editar Búsqueda",children:e.jsx(Le,{variant:"subtle",color:"blue",onClick:()=>ge(d),children:e.jsx(Ss,{size:16})})}),e.jsx($e,{label:"Guardar Vehículos de esta Búsqueda",children:e.jsx(Le,{variant:"subtle",color:"green",onClick:()=>pe(d),disabled:!d.unique_plates||d.unique_plates.length===0,children:e.jsx(ss,{size:16})})}),e.jsx($e,{label:"Eliminar Búsqueda",children:e.jsx(Le,{variant:"subtle",color:"red",onClick:()=>Se(d.id),children:e.jsx(ds,{size:16})})})]})}];return e.jsxs(Ye,{children:[e.jsx("style",{children:Bo}),e.jsx(Ye.Col,{span:{base:12,md:3},style:{minWidth:300},children:e.jsx(Je,{shadow:"sm",p:"md",withBorder:!0,style:{height:"100%"},children:e.jsxs(Te,{gap:"sm",children:[e.jsx(Ue,{order:4,mb:"sm",children:"Definir Filtros"}),e.jsx(We.Wrapper,{label:"Fecha Inicio",size:"xs",className:"lpr-avanzado-datepicker-wrapper",children:e.jsx(jt,{selected:o.fechaInicio,onChange:d=>te("fechaInicio",d),dateFormat:"yyyy-MM-dd",placeholderText:"AAAA-MM-DD",isClearable:!0,customInput:e.jsx(We,{leftSection:e.jsx(Es,{style:r}),style:{width:"100%"}})})}),e.jsx(We.Wrapper,{label:"Fecha Fin",size:"xs",className:"lpr-avanzado-datepicker-wrapper",children:e.jsx(jt,{selected:o.fechaFin,onChange:d=>te("fechaFin",d),dateFormat:"yyyy-MM-dd",placeholderText:"AAAA-MM-DD",isClearable:!0,customInput:e.jsx(We,{leftSection:e.jsx(Es,{style:r}),style:{width:"100%"}})})}),e.jsxs(we,{grow:!0,children:[e.jsx(zs,{label:"Desde Hora",placeholder:"HH:MM",leftSection:e.jsx(st,{size:16}),value:o.timeFrom,onChange:d=>te("timeFrom",d.currentTarget.value)}),e.jsx(zs,{label:"Hasta Hora",placeholder:"HH:MM",leftSection:e.jsx(st,{size:16}),value:o.timeTo,onChange:d=>te("timeTo",d.currentTarget.value)})]}),e.jsx(Xs,{label:"Lectores",placeholder:"Todos",data:l,value:o.selectedLectores,onChange:d=>te("selectedLectores",d),leftSection:e.jsx(Pt,{size:16}),searchable:!0,clearable:!0,disabled:M}),e.jsx(Xs,{label:"Carretera",placeholder:"Todas",data:f,value:o.selectedCarreteras,onChange:d=>te("selectedCarreteras",d),leftSection:e.jsx(Oa,{size:16}),searchable:!0,clearable:!0,disabled:M}),e.jsx(Xs,{label:"Sentido",placeholder:"Ambos",data:Ho,value:o.selectedSentidos||[],onChange:d=>te("selectedSentidos",d),leftSection:e.jsx(Va,{size:16}),searchable:!1,clearable:!0,style:{flex:1,minWidth:100}}),e.jsx(ls,{label:"Matrícula (parcial)",placeholder:"Ej: %BC%",value:o.matricula,onChange:d=>te("matricula",d.currentTarget.value),leftSection:e.jsx(Tt,{size:16})}),e.jsxs(we,{grow:!0,children:[e.jsx(Ns,{label:"Mín. Pasos",placeholder:"Cualquiera",value:o.minPasos??"",onChange:d=>te("minPasos",typeof d=="number"?d:null),min:1,step:1,allowNegative:!1,allowDecimal:!1}),e.jsx(Ns,{label:"Máx. Pasos",placeholder:"Cualquiera",value:o.maxPasos??"",onChange:d=>te("maxPasos",typeof d=="number"?d:null),min:1,step:1,allowNegative:!1,allowDecimal:!1})]}),e.jsx(be,{leftSection:e.jsx(Pr,{size:16}),onClick:me,loading:S,size:"sm",fullWidth:!0,mt:"md",children:"Ejecutar Filtro"}),e.jsx(be,{variant:"subtle",color:"gray",leftSection:e.jsx(Ya,{size:16}),onClick:le,size:"xs",fullWidth:!0,children:"Limpiar Filtros Actuales"}),e.jsx(be,{variant:"outline",leftSection:e.jsx(zr,{size:16}),onClick:re,loading:j,size:"sm",fullWidth:!0,children:"Guardar Búsqueda"})]})})}),e.jsx(Ye.Col,{span:{base:12,md:9},children:e.jsxs(Te,{gap:"lg",children:[e.jsxs(Je,{shadow:"sm",p:"md",withBorder:!0,style:{position:"relative"},children:[e.jsx(Ke,{visible:N||j}),e.jsxs(we,{justify:"space-between",mb:"md",children:[e.jsxs(Ue,{order:4,children:["Búsquedas Guardadas (",T.length,")"]}),e.jsxs(we,{gap:"xs",children:[e.jsxs(be,{leftSection:e.jsx(tr,{size:16}),onClick:P,disabled:O.length===0||j,size:"xs",variant:"outline",children:["Cargar Seleccionadas (",O.length,")"]}),e.jsxs(be,{leftSection:e.jsx(ds,{size:16}),onClick:fe,disabled:O.length===0||j,size:"xs",variant:"filled",color:"red",children:["Eliminar Seleccionadas (",O.length,")"]})]})]}),e.jsx(cs,{className:"saved-searches-datatable",records:T,columns:Re,minHeight:T.length>0?150:0,noRecordsText:"",noRecordsIcon:e.jsx(e.Fragment,{}),selectedRecords:T.filter(d=>O.includes(d.id)),onSelectedRecordsChange:d=>ee(d.map(z=>z.id)),idAccessor:"id"})]}),m.length>0&&e.jsxs(Je,{shadow:"sm",p:"md",withBorder:!0,style:{position:"relative"},children:[e.jsx(Ke,{visible:S||j}),e.jsxs(we,{justify:"space-between",mb:"md",children:[e.jsxs(Ue,{order:4,children:["Resultados (",m.length,")"]}),e.jsxs(we,{gap:"xs",children:[e.jsxs(be,{size:"xs",variant:"outline",leftSection:e.jsx(ws,{size:16}),onClick:R,disabled:h.length===0||S,children:["Marcar Relevante (",h.length,")"]}),e.jsxs(be,{size:"xs",variant:"outline",color:"orange",leftSection:e.jsx(Ha,{size:16}),onClick:K,disabled:h.length===0||S,children:["Desmarcar Relevante (",h.length,")"]}),e.jsxs(be,{size:"xs",variant:"outline",color:"green",leftSection:e.jsx(ss,{size:16}),onClick:de,disabled:h.length===0||S,children:["Guardar Vehículos (",h.length,")"]})]})]}),e.jsx(cs,{className:"results-datatable",records:ce,columns:Ne,idAccessor:"matricula",totalRecords:m.length,recordsPerPage:E,page:w,onPageChange:D,sortStatus:k,onSortStatusChange:De,withTableBorder:!0,borderRadius:"sm",withColumnBorders:!0,striped:!0,highlightOnHover:!0,minHeight:ce.length>0?150:void 0,noRecordsText:"",noRecordsIcon:e.jsx(e.Fragment,{}),selectedRecords:h,onSelectedRecordsChange:ze,isRecordSelectable:d=>!S,rowClassName:({matricula:d})=>s.has(d)?"highlighted-row":void 0,rowExpansion:{allowMultiple:!0,expanded:{recordIds:y,onRecordIdsChange:_e},content:({record:d})=>e.jsx(ie,{p:"sm",bg:"gray.1",style:{borderTop:"1px solid var(--mantine-color-gray-3)"},children:e.jsx(Te,{gap:"xs",children:d.readings.length>0?d.readings.map(z=>{var G,he;return e.jsx(Je,{shadow:"xs",p:"xs",withBorder:!0,children:e.jsxs(we,{justify:"space-between",gap:"xs",wrap:"nowrap",children:[e.jsx(ne,{size:"xs",fw:500,children:L(z.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss")}),e.jsxs(ne,{size:"xs",children:["Sentido: ",((G=z.lector)==null?void 0:G.Sentido)||"-"]}),e.jsxs(ne,{size:"xs",children:["Carretera: ",((he=z.lector)==null?void 0:he.Carretera)||"-"]}),e.jsxs(ne,{size:"xs",children:["Carril: ",z.Carril||"-"]})]})},z.ID_Lectura)}):e.jsx(ne,{size:"xs",c:"dimmed",children:"No hay lecturas individuales disponibles para esta matrícula."})})})}})]})]})}),e.jsx(Ps,{opened:_,onClose:A,title:`Editar Búsqueda: ${V==null?void 0:V.nombre}`,centered:!0,size:"lg",children:e.jsx("form",{onSubmit:oe.onSubmit(je),children:e.jsxs(Te,{children:[e.jsx(ls,{required:!0,label:"Nombre",placeholder:"Nombre descriptivo",...oe.getInputProps("nombre")}),e.jsx(pt,{label:"Color Etiqueta",placeholder:"Elige un color (opcional)",...oe.getInputProps("color"),format:"hex",swatches:["#25262b","#868e96","#fa5252","#e64980","#be4bdb","#7950f2","#4c6ef5","#228be6","#15aabf","#12b886","#40c057","#82c91e","#fab005","#fd7e14"]}),e.jsx(lt,{label:"Notas (opcional)",placeholder:"Añade alguna nota o comentario...",...oe.getInputProps("notas"),minRows:3}),e.jsxs(we,{justify:"flex-end",mt:"md",children:[e.jsx(be,{variant:"default",onClick:A,disabled:I,children:"Cancelar"}),e.jsx(be,{type:"submit",loading:I,children:"Guardar Cambios"})]})]})})})]})}function Go({lecturas:t,loading:s,totalRecords:a,page:r,onPageChange:o,pageSize:i,sortStatus:l,onSortStatusChange:u,selectedRecordIds:f,onSelectionChange:n,onEditNota:m,onDesmarcar:v,onDesmarcarSeleccionados:y,onGuardarVehiculo:x,onGuardarVehiculosSeleccionados:h,onRefresh:c}){const j=p.useCallback((M,$)=>{const w=$?[...f,M]:f.filter(D=>D!==M);n(w)},[f,n]),g=p.useCallback(M=>{const $=Array.isArray(t)?t.map(w=>w.ID_Lectura):[];n(M?$:[])},[t,n]),S=p.useMemo(()=>{let M=Array.isArray(t)?[...t]:[];l!=null&&l.columnAccessor&&(M=os.orderBy(M,[l.columnAccessor],[l.direction]));const $=(r-1)*i,w=$+i;return M.slice($,w)},[t,l,r,i]),b=p.useMemo(()=>{const M=Array.isArray(t)?t:[],$=M.length>0&&f.length===M.length,w=f.length>0&&f.length<M.length;return[{accessor:"select",title:e.jsx(rs,{"aria-label":"Seleccionar todas las filas",checked:$,indeterminate:w,onChange:D=>g(D.currentTarget.checked)}),width:"0%",styles:{cell:{paddingLeft:"var(--mantine-spacing-xs)",paddingRight:"var(--mantine-spacing-xs)"}},render:D=>e.jsx(rs,{"aria-label":`Seleccionar fila ${D.ID_Lectura}`,checked:f.includes(D.ID_Lectura),onChange:E=>j(D.ID_Lectura,E.currentTarget.checked),onClick:E=>E.stopPropagation()})},{accessor:"Fecha_y_Hora",title:"Fecha y Hora",render:D=>L(D.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss"),sortable:!0,width:140},{accessor:"Matricula",title:"Matrícula",sortable:!0,width:100},{accessor:"ID_Lector",title:"ID Lector",render:D=>D.ID_Lector||"-",sortable:!0,width:150},{accessor:"Carril",title:"Carril",render:D=>D.Carril||"-",sortable:!0,width:70},{accessor:"relevancia.Nota",title:"Nota",render:D=>{var E;return((E=D.relevancia)==null?void 0:E.Nota)||"-"},width:200},{accessor:"actions",title:"Acciones",width:120,textAlign:"center",render:D=>e.jsxs(we,{gap:"xs",justify:"center",wrap:"nowrap",children:[e.jsx($e,{label:"Editar Nota",children:e.jsx(Le,{variant:"subtle",color:"blue",onClick:()=>m(D),disabled:!D.relevancia,children:e.jsx(Ss,{size:16})})}),e.jsx($e,{label:"Guardar Vehículo",children:e.jsx(Le,{variant:"subtle",color:"green",onClick:()=>x(D),disabled:!D.Matricula,children:e.jsx(ss,{size:16})})}),e.jsx($e,{label:"Desmarcar como Relevante",children:e.jsx(Le,{variant:"subtle",color:"red",onClick:()=>v(D.ID_Lectura),disabled:!D.relevancia,children:e.jsx(ra,{size:16})})})]})}]},[t,f,m,x,v,j,g]);return e.jsxs(ie,{style:{position:"relative"},children:[e.jsx(Ke,{visible:s}),e.jsx(Te,{children:e.jsxs(Je,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsxs(we,{justify:"space-between",align:"center",mb:"sm",children:[e.jsxs(Ue,{order:4,children:["Lecturas Marcadas como Relevantes (",a,")"]}),e.jsxs(we,{gap:"xs",children:[e.jsxs(be,{color:"red",variant:"light",size:"xs",leftSection:e.jsx(ds,{size:16}),disabled:f.length===0||s,onClick:y,children:["Desmarcar Selección (",f.length,")"]}),e.jsxs(be,{color:"green",variant:"light",size:"xs",leftSection:e.jsx(ss,{size:16}),disabled:f.length===0||s,onClick:h,children:["Guardar Vehículos (",f.length,")"]}),e.jsx(be,{leftSection:e.jsx(Is,{size:16}),onClick:c,variant:"default",size:"xs",disabled:s,children:"Actualizar Lista"})]})]}),a===0&&!s&&e.jsx(ne,{c:"dimmed",children:"No hay lecturas marcadas como relevantes para este caso."}),a>0&&e.jsx(cs,{records:S,columns:b,totalRecords:a,recordsPerPage:i,page:r,onPageChange:o,sortStatus:l,onSortStatusChange:u,idAccessor:"ID_Lectura",withTableBorder:!0,borderRadius:"sm",withColumnBorders:!0,striped:!0,highlightOnHover:!0,minHeight:200,noRecordsText:"",noRecordsIcon:e.jsx(e.Fragment,{})})]})})]})}const Wo=[{accessor:"Fecha_y_Hora",title:"Fecha y Hora",render:t=>L(t.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss"),width:160},{accessor:"ID_Lector",title:"ID Lector",width:120},{accessor:"Tipo_Fuente",title:"Tipo",width:80},{accessor:"Carril",title:"Carril",width:80}];function Uo({casoId:t}){const[s,a]=p.useState([]),[r,o]=p.useState(!0),[i,l]=p.useState(null),[u,f]=p.useState([]),[n,m]=p.useState({}),[v,y]=p.useState({}),[x,h]=p.useState({}),[c,j]=p.useState([]),[g,S]=p.useState(1),b=15,[M,$]=p.useState({columnAccessor:"Matricula",direction:"asc"}),w=p.useCallback(async()=>{var P,le;if(!t){l("ID de caso inválido."),o(!1);return}o(!0),l(null);try{const J=await Ae.get(`/casos/${t}/vehiculos`);a(J.data||[])}catch(J){console.error("Error fetching vehiculos:",J),l(((le=(P=J.response)==null?void 0:P.data)==null?void 0:le.detail)||"No se pudieron cargar los vehículos."),a([])}finally{o(!1)}},[t]);p.useEffect(()=>{w()},[w]),p.useEffect(()=>{const P=()=>{console.log("[VehiculosPanel (vehiculos)]: Evento listaVehiculosCambiada recibido (handler inline), recargando..."),w()};return console.log("[VehiculosPanel (vehiculos)]: Suscribiéndose a 'listaVehiculosCambiada' (inline)"),hs.on("listaVehiculosCambiada",P),()=>{console.log("[VehiculosPanel (vehiculos)]: Desuscribiéndose de 'listaVehiculosCambiada' (inline)"),hs.off("listaVehiculosCambiada",P)}},[w]),p.useEffect(()=>{const P=u.filter(le=>!(le in n)&&!v[le]);P.length>0&&(y(le=>{const J={...le};return P.forEach(fe=>{J[fe]=!0}),J}),Promise.allSettled(P.map(async le=>{var J,fe;try{const De=(await Ae.get(`/vehiculos/${le}/lecturas?caso_id=${t}`)).data||[],ze=De.filter(K=>K.Tipo_Fuente==="LPR"),R=De.some(K=>K.Tipo_Fuente==="GPS");m(K=>({...K,[le]:ze})),h(K=>({...K,[le]:R}))}catch(_e){console.error(`Error fetching lecturas for vehiculo ${le}:`,_e),B.show({title:`Error Lecturas Vehículo ${le}`,message:((fe=(J=_e.response)==null?void 0:J.data)==null?void 0:fe.detail)||"No se pudieron cargar las lecturas.",color:"red"}),m(De=>({...De,[le]:[]})),h(De=>({...De,[le]:!1}))}finally{y(_e=>({..._e,[le]:!1}))}})))},[u,t]);const D=p.useCallback(async(P,le)=>{var _e,De;const J=P[le],fe=!J;a(ze=>ze.map(R=>R.ID_Vehiculo===P.ID_Vehiculo?{...R,[le]:fe}:R));try{await Ae.put(`/vehiculos/${P.ID_Vehiculo}`,{[le]:fe}),console.log(`Vehículo ${P.Matricula}, campo ${le} actualizado a ${fe}`)}catch(ze){console.error(`Error actualizando ${le} para vehículo ${P.ID_Vehiculo}:`,ze),B.show({title:`Error al actualizar ${le}`,message:((De=(_e=ze.response)==null?void 0:_e.data)==null?void 0:De.detail)||"No se pudo guardar el cambio.",color:"red"}),a(R=>R.map(K=>K.ID_Vehiculo===P.ID_Vehiculo?{...K,[le]:J}:K))}},[]),[E,k]=p.useState(null),[F,T]=p.useState(!1),[H,O]=p.useState(""),[ee,X]=p.useState(""),[W,N]=p.useState(""),[q,_]=p.useState(""),[U,A]=p.useState(!1),[V,C]=p.useState(""),[I,se]=p.useState(!1),[oe,ue]=p.useState(!1),[ce,te]=p.useState(!1),ye=p.useCallback(P=>{k(P),O(P.Marca||""),X(P.Modelo||""),N(P.Color||""),_(P.Propiedad||""),A(P.Alquiler),C(P.Observaciones||""),se(P.Comprobado),ue(P.Sospechoso),T(!0)},[]),Q=p.useCallback(()=>{T(!1),k(null)},[]),me=p.useCallback(async()=>{var le,J;if(!E)return;te(!0);const P={Marca:H||null,Modelo:ee||null,Color:W||null,Propiedad:q||null,Alquiler:U,Observaciones:V||null,Comprobado:I,Sospechoso:oe};try{await Ae.put(`/vehiculos/${E.ID_Vehiculo}`,P),B.show({title:"Éxito",message:`Vehículo ${E.Matricula} actualizado.`,color:"green"}),Q(),w()}catch(fe){console.error("Error updating vehiculo:",fe),B.show({title:"Error al Actualizar",message:((J=(le=fe.response)==null?void 0:le.data)==null?void 0:J.detail)||"No se pudo guardar los cambios.",color:"red"})}finally{te(!1)}},[E,H,ee,W,q,U,V,I,oe,w,Q]),re=p.useCallback(P=>{ys({title:`Eliminar Vehículo ${P.Matricula}`,centered:!0,children:e.jsx(ne,{size:"sm",children:"¿Estás seguro...? Esta acción no se puede deshacer."}),labels:{confirm:"Eliminar",cancel:"Cancelar"},confirmProps:{color:"red"},onConfirm:async()=>{var le,J;o(!0);try{await Ae.delete(`/vehiculos/${P.ID_Vehiculo}`),B.show({title:"Vehículo Eliminado",message:`Vehículo ${P.Matricula} eliminado.`,color:"green"}),w()}catch(fe){console.error("Error deleting vehiculo:",fe),B.show({title:"Error al Eliminar",message:((J=(le=fe.response)==null?void 0:le.data)==null?void 0:J.detail)||"No se pudo eliminar.",color:"red"})}finally{o(!1)}}})},[w]),Se=P=>{S(1),$(P)},ge=p.useMemo(()=>{let P=[...s];const{columnAccessor:le,direction:J}=M;le&&(P=os.orderBy(P,[le],[J]));const fe=(g-1)*b,_e=fe+b;return P.slice(fe,_e)},[s,M,g,b]),je=p.useMemo(()=>{const P=s.length>0&&c.length===s.length,le=c.length>0&&c.length<s.length;return[{accessor:"select",title:e.jsx(rs,{"aria-label":"Seleccionar todas las filas",checked:P,indeterminate:le,onChange:J=>{j(J.currentTarget.checked?s:[])}}),width:"0%",styles:{cell:{paddingLeft:"var(--mantine-spacing-xs)",paddingRight:"var(--mantine-spacing-xs)"}},render:J=>e.jsx(rs,{"aria-label":`Seleccionar fila ${J.ID_Vehiculo}`,checked:c.some(fe=>fe.ID_Vehiculo===J.ID_Vehiculo),onChange:fe=>{const _e=fe.currentTarget.checked;j(De=>_e?[...De,J]:De.filter(ze=>ze.ID_Vehiculo!==J.ID_Vehiculo))},onClick:fe=>fe.stopPropagation()})},{accessor:"Matricula",title:"Matrícula",sortable:!0},{accessor:"Marca",title:"Marca",sortable:!0},{accessor:"Modelo",title:"Modelo",sortable:!0},{accessor:"Color",title:"Color",sortable:!0},{accessor:"Propiedad",title:"Propiedad",sortable:!0},{accessor:"totalLecturasLprCaso",title:"Lecturas LPR",width:110,textAlignment:"center",sortable:!0,render:J=>typeof J.total_lecturas_lpr_caso=="number"?J.total_lecturas_lpr_caso:u.includes(J.ID_Vehiculo)&&n[J.ID_Vehiculo]?n[J.ID_Vehiculo].length:"..."},{accessor:"Observaciones",title:"Observaciones"},{accessor:"Comprobado",title:"Comp.",width:70,textAlignment:"center",sortable:!0,render:J=>e.jsx($e,{label:J.Comprobado?"Desmarcar Comprobado":"Marcar Comprobado",children:e.jsx(Le,{variant:"subtle",color:J.Comprobado?"teal":"gray",onClick:()=>D(J,"Comprobado"),children:J.Comprobado?e.jsx(Er,{size:18}):e.jsx(As,{size:18})})})},{accessor:"Sospechoso",title:"Sosp.",width:70,textAlignment:"center",sortable:!0,render:J=>e.jsx($e,{label:J.Sospechoso?"Desmarcar Sospechoso":"Marcar Sospechoso",children:e.jsx(Le,{variant:"subtle",color:J.Sospechoso?"red":"gray",onClick:()=>D(J,"Sospechoso"),children:J.Sospechoso?e.jsx(Lr,{size:18}):e.jsx(As,{size:18})})})},{accessor:"actions",title:"Acciones",width:100,textAlignment:"center",render:J=>e.jsxs(we,{gap:"xs",justify:"center",wrap:"nowrap",children:[e.jsx($e,{label:"Editar Vehículo",children:e.jsx(Le,{variant:"subtle",color:"blue",onClick:()=>ye(J),children:e.jsx(Ss,{size:16})})}),e.jsx($e,{label:"Eliminar Vehículo",children:e.jsx(Le,{variant:"subtle",color:"red",onClick:()=>re(J),disabled:c.length>0,children:e.jsx(ds,{size:16})})})]})}]},[s,c,u,n,ye,re,D]);return e.jsxs(ie,{style:{position:"relative"},children:[e.jsx(Ke,{visible:r}),e.jsxs(Je,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsxs(we,{justify:"space-between",align:"center",mb:"md",children:[e.jsx(Ue,{order:3,children:"Vehículos Identificados en el Caso"}),e.jsxs(we,{children:[c.length>0&&e.jsxs(be,{color:"red",variant:"outline",size:"xs",children:["Eliminar Selección (",c.length,")"]}),e.jsx(be,{leftSection:e.jsx(Is,{size:16}),onClick:w,variant:"default",size:"xs",disabled:r,children:"Actualizar Lista"})]})]}),i&&e.jsx(ns,{color:"red",title:"Error",mb:"md",children:i}),e.jsx(cs,{records:ge,columns:je,minHeight:200,withTableBorder:!0,borderRadius:"sm",withColumnBorders:!0,striped:!0,highlightOnHover:!0,idAccessor:"ID_Vehiculo",noRecordsText:"",noRecordsIcon:e.jsx(e.Fragment,{}),fetching:r,totalRecords:s.length,recordsPerPage:b,page:g,onPageChange:S,sortStatus:M,onSortStatusChange:Se,rowExpansion:{expanded:{recordIds:u,onRecordIdsChange:f},allowMultiple:!0,content:({record:P})=>e.jsxs(ie,{p:"md",style:{background:"#f9f9f9"},children:[e.jsx(Ke,{visible:v[P.ID_Vehiculo]??!1}),n[P.ID_Vehiculo]&&n[P.ID_Vehiculo].length>0?e.jsxs(e.Fragment,{children:[e.jsxs(ne,{fw:500,mb:"xs",children:["Lecturas LPR (",n[P.ID_Vehiculo].length,") para Matrícula: ",P.Matricula]}),e.jsx(cs,{records:n[P.ID_Vehiculo],columns:Wo,minHeight:100,noRecordsText:"",noRecordsIcon:e.jsx(e.Fragment,{}),withTableBorder:!1})]}):!v[P.ID_Vehiculo]&&e.jsx(ne,{c:"dimmed",size:"sm",children:"No hay lecturas LPR registradas para este vehículo en este caso."}),(x[P.ID_Vehiculo]??!1)&&e.jsx(be,{mt:"sm",size:"xs",variant:"outline",children:"Lecturas GPS"}),(v[P.ID_Vehiculo]??!1)&&e.jsx(ne,{c:"dimmed",size:"sm",children:"Cargando lecturas..."})]})}})]}),e.jsxs(Ps,{opened:F,onClose:Q,title:`Editar Vehículo: ${E==null?void 0:E.Matricula}`,centered:!0,size:"lg",children:[e.jsx(Ke,{visible:ce}),e.jsxs(Te,{children:[e.jsx(ls,{label:"Marca",value:H,onChange:P=>O(P.currentTarget.value)}),e.jsx(ls,{label:"Modelo",value:ee,onChange:P=>X(P.currentTarget.value)}),e.jsx(ls,{label:"Color",value:W,onChange:P=>N(P.currentTarget.value)}),e.jsx(ls,{label:"Propiedad",value:q,onChange:P=>_(P.currentTarget.value)}),e.jsx(rs,{label:"Alquiler",checked:U,onChange:P=>A(P.currentTarget.checked),mt:"xs"}),e.jsx(lt,{label:"Observaciones",value:V,onChange:P=>C(P.currentTarget.value),autosize:!0,minRows:2}),e.jsxs(we,{children:[e.jsx(rs,{label:"Comprobado",checked:I,onChange:P=>se(P.currentTarget.checked)}),e.jsx(rs,{label:"Sospechoso",checked:oe,onChange:P=>ue(P.currentTarget.checked)})]}),e.jsxs(we,{justify:"flex-end",mt:"md",children:[e.jsx(be,{variant:"default",onClick:Q,disabled:ce,children:"Cancelar"}),e.jsx(be,{onClick:me,loading:ce,children:"Guardar Cambios"})]})]})]})]})}const Ko=({bounds:t})=>{const s=Xa();return p.useEffect(()=>{if(t&&t.isValid()){console.log("[ChangeView] Fitting bounds:",t.toBBoxString());try{s.fitBounds(t,{padding:[50,50]})}catch(a){console.error("[ChangeView] Error fitting bounds:",a)}}},[s,t]),null};function Zo({casoId:t}){const[s,a]=p.useState(60),[r,o]=p.useState(2),[i,l]=p.useState(""),[u,f]=p.useState(null),[n,m]=p.useState(null),[v,y]=p.useState(""),[x,h]=p.useState(""),[c,j]=p.useState(null),[g,S]=p.useState(!1),[b,M]=p.useState(null),[$,w]=p.useState({}),[D,E]=p.useState("Inicializando..."),[k,F]=p.useState(new Set),[T,H]=p.useState(!1),[O,ee]=p.useState(!1),X=p.useCallback(async()=>{var I,se,oe,ue;if(s===""||r===""){B.show({title:"Faltan Parámetros",message:"Ventana de tiempo y Mín. Coincidencias son obligatorios.",color:"orange"});return}S(!0),M(null),j(null),F(new Set);const C={ventana_tiempo_segundos:Number(s),min_coincidencias:Number(r)};i.trim()&&(C.matricula_objetivo=i.trim()),u&&(C.fecha_inicio=L(u).format("YYYY-MM-DD")),n&&(C.fecha_fin=L(n).format("YYYY-MM-DD")),/^([01]\d|2[0-3]):([0-5]\d)$/.test(v)?C.hora_inicio=v:v&&console.warn("Formato hora inicio inválido, no se enviará."),/^([01]\d|2[0-3]):([0-5]\d)$/.test(x)?C.hora_fin=x:x&&console.warn("Formato hora fin inválido, no se enviará.");try{console.log("Enviando payload detección convoyes:",C);const ce=await Ae.post(`/casos/${t}/lanzaderas/detectar`,C);j(ce.data||{vehiculos_en_convoy:[],detalles_coocurrencias:[]}),((se=(I=ce.data)==null?void 0:I.vehiculos_en_convoy)==null?void 0:se.length)>0?B.show({title:"Detección Completada",message:`Se encontraron ${ce.data.vehiculos_en_convoy.length} vehículos involucrados en convoyes.`,color:"green"}):B.show({title:"Detección Completada",message:"No se encontraron convoyes con los criterios especificados.",color:"blue"})}catch(ce){console.error("Error en detección de convoyes:",ce);const te=((ue=(oe=ce.response)==null?void 0:oe.data)==null?void 0:ue.detail)||ce.message||"Error desconocido al detectar convoyes.";M(te),j({vehiculos_en_convoy:[],detalles_coocurrencias:[]}),B.show({title:"Error en Detección",message:te,color:"red"})}finally{S(!1)}},[t,s,r,i,u,n,v,x]),W=p.useMemo(()=>!c||k.size===0?[]:c.detalles_coocurrencias.filter(C=>C.matriculas_par.some(I=>k.has(I))),[c,k]),N=p.useMemo(()=>{const C=[];return W.forEach(I=>{if(I.lat!=null&&I.lon!=null){const se=I.matriculas_par.join(" / ");C.push({lat:I.lat,lon:I.lon,popupContent:e.jsxs(Te,{gap:2,children:[e.jsx(ne,{size:"sm",fw:500,children:se}),e.jsxs(ne,{size:"xs",children:["Lector: ",I.lector_id||"N/A"]}),e.jsxs(ne,{size:"xs",children:["Hora Veh. 1: ",L(I.timestamp_vehiculo_1).format("HH:mm:ss")]}),e.jsxs(ne,{size:"xs",children:["Hora Veh. 2: ",L(I.timestamp_vehiculo_2).format("HH:mm:ss")]}),e.jsxs(ne,{size:"xs",children:["Fecha: ",L(I.timestamp_vehiculo_1).format("DD/MM/YYYY")]})]})})}}),console.log("[LanzaderaPanel] Marcadores calculados:",C.length),C},[W]),q=p.useMemo(()=>{const C=N.map(I=>[I.lat,I.lon]);if(C.length>0){const I=Za.latLngBounds(C);return console.log("[LanzaderaPanel] Bounds calculados:",I.toBBoxString()),I.isValid()?I:null}return console.log("[LanzaderaPanel] No hay puntos válidos para calcular bounds."),null},[N]),_=p.useMemo(()=>{if(q&&q.isValid()){const C=q.getCenter();return[C.lat,C.lng]}return N.length>0&&typeof N[0].lat=="number"&&typeof N[0].lon=="number"?[N[0].lat,N[0].lon]:[40.416775,-3.70379]},[N,q]),U=p.useMemo(()=>N.length>0?13:6,[N]);p.useEffect(()=>{var I;const C=`[Debug useEffect] Vehiculos En Convoy: ${((I=c==null?void 0:c.vehiculos_en_convoy)==null?void 0:I.length)??0}, Activos: ${k.size}, Detalles Filtrados: ${W.length}, Marcadores: ${N.length}`;console.log(C),E(C)},[c,k,W,N]);const A=async()=>{const C=Array.from(k);if(C.length===0)return;H(!0);const I=B.show({loading:!0,title:"Guardando Vehículos",message:`Guardando ${C.length} vehículo(s) seleccionado(s)...`,autoClose:!1,withCloseButton:!1}),se=await Promise.allSettled(C.map(Q=>Ae.post("/vehiculos",{Matricula:Q})));let oe=0,ue=0,ce=0;se.forEach((Q,me)=>{const re=C[me];Q.status==="fulfilled"?Q.value.status===201?oe++:ue++:(ce++,console.error(`Error guardando vehículo ${re}:`,Q.reason))}),H(!1);let te="",ye="green";oe>0&&(te+=`${oe} guardado(s). `),ue>0&&(te+=`${ue} ya existente(s). `),ce>0?(te+=`${ce} con error.`,ye=oe>0||ue>0?"orange":"red"):oe===0&&ue>0&&(ye="blue"),B.update({id:I,title:"Guardado Completado",message:te.trim()||"No se realizaron cambios.",color:ye,loading:!1,withCloseButton:!0,autoClose:5e3}),oe>0&&hs.emit("listaVehiculosCambiada")},V=async()=>{var oe,ue;const C=Array.from(k);if(C.length===0)return;ee(!0);const I=B.show({loading:!0,title:"Marcando Lecturas Relevantes",message:`Buscando lecturas para ${C.length} vehículo(s)...`,autoClose:!1,withCloseButton:!1});let se=[];try{if(se=(await Ae.post("/lecturas/por_matriculas_y_filtros_combinados",{matriculas:C,caso_id:t,tipo_fuente:"LPR"})).data.map(me=>me.ID_Lectura),se.length===0){B.update({id:I,title:"Sin Lecturas",message:"No se encontraron lecturas para los vehículos seleccionados en este caso.",color:"orange",loading:!1,withCloseButton:!0,autoClose:5e3}),ee(!1);return}B.update({id:I,title:"Marcando Lecturas Relevantes",message:`Marcando ${se.length} lectura(s) como relevante(s)...`,loading:!0});const te=await Promise.allSettled(se.map(me=>Ae.post(`/lecturas/${me}/marcar_relevante`,{caso_id:t})));let ye=0,Q=0;te.forEach(me=>{me.status==="fulfilled"?ye++:(Q++,console.error("Error marcando lectura relevante:",me.reason))}),B.update({id:I,title:"Marcado Completado",message:`${ye} lecturas marcadas como relevantes.`+(Q>0?` ${Q} fallaron.`:""),color:Q>0?"orange":"green",loading:!1,withCloseButton:!0,autoClose:5e3})}catch(ce){console.error("Error en el proceso de marcar lecturas relevantes:",ce),B.update({id:I,title:"Error General",message:((ue=(oe=ce.response)==null?void 0:oe.data)==null?void 0:ue.detail)||"No se pudieron marcar las lecturas relevantes.",color:"red",loading:!1,withCloseButton:!0,autoClose:5e3})}finally{ee(!1)}};return e.jsxs(Te,{gap:"lg",children:[e.jsx(Je,{shadow:"sm",p:"md",withBorder:!0,children:e.jsxs(Te,{children:[e.jsx(Ue,{order:4,mb:"sm",children:"Parámetros de Detección de Convoy"}),e.jsxs(Ye,{gutter:"md",children:[e.jsx(Ye.Col,{span:{base:12,md:4},children:e.jsx(ls,{label:"Matrícula Objetivo (Opcional)",placeholder:"Filtrar por esta matrícula",value:i,onChange:C=>l(C.currentTarget.value),leftSection:e.jsx(Tt,{size:16})})}),e.jsx(Ye.Col,{span:{base:12,md:4},children:e.jsx(Ns,{label:"Ventana Tiempo (segundos)",value:s,onChange:C=>a(typeof C=="number"?C:""),min:1,step:10,required:!0,leftSection:e.jsx(st,{size:16})})}),e.jsx(Ye.Col,{span:{base:12,md:4},children:e.jsx(Ns,{label:"Mín. Coincidencias",value:r,onChange:C=>o(typeof C=="number"?C:""),min:2,step:1,required:!0,leftSection:e.jsx(Tr,{size:16})})})]}),e.jsxs(Ye,{gutter:"md",align:"flex-end",children:[e.jsx(Ye.Col,{span:{base:12,md:3},children:e.jsx(Rs,{label:"Fecha Inicio (Opcional)",placeholder:"Desde...",value:u,onChange:f,clearable:!0,leftSection:e.jsx(Es,{size:16}),valueFormat:"DD/MM/YYYY"})}),e.jsx(Ye.Col,{span:{base:12,md:3},children:e.jsx(Rs,{label:"Fecha Fin (Opcional)",placeholder:"Hasta...",value:n,onChange:m,clearable:!0,leftSection:e.jsx(Es,{size:16}),valueFormat:"DD/MM/YYYY"})}),e.jsx(Ye.Col,{span:{base:12,md:2},children:e.jsx(zs,{label:"Hora Inicio (Opc)",placeholder:"HH:MM",value:v,onChange:C=>y(C.currentTarget.value),rightSection:v?e.jsx(Le,{onClick:()=>y(""),variant:"subtle",size:"xs",children:e.jsx(As,{size:14})}):null,leftSection:e.jsx($t,{size:16})})}),e.jsx(Ye.Col,{span:{base:12,md:2},children:e.jsx(zs,{label:"Hora Fin (Opc)",placeholder:"HH:MM",value:x,onChange:C=>h(C.currentTarget.value),rightSection:x?e.jsx(Le,{onClick:()=>h(""),variant:"subtle",size:"xs",children:e.jsx(As,{size:14})}):null,leftSection:e.jsx($t,{size:16})})}),e.jsx(Ye.Col,{span:{base:12,md:2},children:e.jsx(be,{onClick:X,loading:g,leftSection:e.jsx(Ia,{size:16}),fullWidth:!0,children:"Detectar Convoy"})})]})]})}),e.jsxs(Je,{shadow:"sm",p:"md",withBorder:!0,style:{position:"relative"},children:[e.jsx(Ke,{visible:g&&!c}),c&&e.jsxs(Ue,{order:4,mb:"md",children:["Resultados de Detección (",c.vehiculos_en_convoy.length," Vehículos)"]}),b&&e.jsx(ns,{title:"Error",color:"red",icon:e.jsx(Ka,{}),mb:"md",children:b}),c&&c.vehiculos_en_convoy.length>0&&e.jsxs(ie,{mb:"md",children:[e.jsx(ne,{size:"sm",fw:500,mb:5,children:"Selecciona vehículos para ver detalles y mapa:"}),e.jsxs(we,{justify:"space-between",align:"center",wrap:"nowrap",children:[e.jsx(ie,{style:{flexGrow:1,overflow:"hidden"},children:e.jsx(_s.Group,{multiple:!0,value:Array.from(k),onChange:C=>F(new Set(C)),children:e.jsx(we,{gap:7,style:{flexWrap:"wrap"},children:c.vehiculos_en_convoy.map(C=>e.jsx(_s,{value:C,variant:"outline",disabled:g,children:C},C))})})}),e.jsxs(we,{gap:"xs",style:{flexShrink:0},children:[e.jsxs(be,{variant:"outline",color:"green",size:"xs",leftSection:e.jsx(ss,{size:16}),onClick:A,disabled:k.size===0||T||O,loading:T,children:["Guardar Vehículos (",k.size,")"]}),e.jsxs(be,{variant:"outline",color:"yellow",size:"xs",leftSection:e.jsx(ws,{size:16}),onClick:V,disabled:k.size===0||T||O,loading:O,children:["Marcar Relevantes (",k.size,")"]})]})]})]}),!g&&!c&&!b&&e.jsx(ne,{c:"dimmed",ta:"center",mt:"md",children:"Ejecuta la detección para ver resultados."}),!g&&c&&c.vehiculos_en_convoy.length===0&&!b&&e.jsx(ne,{c:"dimmed",ta:"center",mt:"md",children:"No se han detectado convoyes con los criterios especificados."}),k.size>0&&W.length>0&&e.jsxs(ie,{mt:"sm",children:[e.jsxs(Ue,{order:5,mb:"xs",children:["Detalles de Co-ocurrencias (",W.length,")"]}),e.jsx(cs,{records:W,columns:[{accessor:"matriculas_par",title:"Par Convoy",render:C=>C.matriculas_par.join(" / "),width:180},{accessor:"lector_id",title:"Lector",render:C=>C.lector_id||"N/A"},{accessor:"sentido",title:"Sentido",render:C=>C.sentido||"-"},{accessor:"orientacion",title:"Orientación",render:C=>C.orientacion||"-"},{accessor:"timestamp_vehiculo_1",title:"Fecha/Hora Veh. 1",render:C=>L(C.timestamp_vehiculo_1).format("DD/MM/YY HH:mm:ss"),width:190},{accessor:"timestamp_vehiculo_2",title:"Fecha/Hora Veh. 2",render:C=>L(C.timestamp_vehiculo_2).format("DD/MM/YY HH:mm:ss"),width:190},{accessor:"lat",title:"Latitud",render:C=>{var I;return((I=C.lat)==null?void 0:I.toFixed(6))??"-"}},{accessor:"lon",title:"Longitud",render:C=>{var I;return((I=C.lon)==null?void 0:I.toFixed(6))??"-"}}],minHeight:150,withTableBorder:!0,borderRadius:"sm",withColumnBorders:!0,striped:!0,highlightOnHover:!0,noRecordsText:"",noRecordsIcon:e.jsx(e.Fragment,{}),idAccessor:C=>`${C.matriculas_par.join("-")}-${C.lector_id}-${C.timestamp_vehiculo_1}-${C.timestamp_vehiculo_2}`})]}),k.size>0&&W.length===0&&!g&&e.jsx(ne,{c:"dimmed",ta:"center",mt:"md",children:"No se encontraron detalles de co-ocurrencia para los vehículos seleccionados."})]}),k.size>0&&N.length>0&&e.jsxs(Je,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsxs(Ue,{order:4,mb:"md",children:["Mapa de Co-ocurrencias (",Array.from(k).join(" / "),")"]}),e.jsx(ie,{style:{height:"500px",width:"100%"},children:e.jsxs(Ft,{center:_,zoom:U,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,children:[e.jsx(Ot,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(Ko,{bounds:q}),N.map((C,I)=>e.jsx(Vt,{position:[C.lat,C.lon],children:e.jsx(Yt,{children:C.popupContent})},`marker-${Array.from(k).sort().join("-")}-${I}`))]},Array.from(k).sort().join("-"))})]}),k.size>0&&N.length===0&&!g&&e.jsx(ns,{title:"Mapa no disponible",color:"blue",icon:e.jsx(Rr,{}),children:"No se encontraron coordenadas para las co-ocurrencias de los vehículos seleccionados."})]})}const Xo=[{id:"analisis-lpr",label:"Lecturas LPR",icon:Pt},{id:"busqueda-cruzada-lpr",label:"Búsqueda Cruzada",icon:Ir},{id:"lanzadera",label:"Vehículo Lanzadera",icon:$r},{id:"lecturas-relevantes",label:"Lecturas Relevantes",icon:ws},{id:"vehiculos",label:"Vehículos",icon:ss},{id:"mapa",label:"Mapa",icon:Ja},{id:"archivos",label:"Archivos Importados",icon:Nr}],xs={"analisis-lpr":e.jsxs(ie,{maw:400,children:[e.jsx(ne,{fw:500,mb:"sm",children:"Ayuda: Lecturas LPR"}),e.jsxs(Te,{gap:"xs",children:[e.jsx(ne,{size:"xs",children:"Esta pestaña muestra las lecturas LPR del caso."}),e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Filtros (izquierda):"}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"4px 0"},children:[e.jsx("li",{children:"Busca por matrícula, fechas, horas, lector, carretera, etc."}),e.jsxs("li",{children:[e.jsx("strong",{children:"Búsqueda Parcial:"}),` Campos como 'Matrícula' permiten búsquedas parciales (p.ej., "1234" encontrará "1234ABC").`]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Comodines:"}),` Puedes usar comodines como '%' para representar caracteres desconocidos (p.ej., "12%4AB" podría encontrar "1234ABC" o "1294ABC").`]}),e.jsx("li",{children:"Aplica los filtros para actualizar la tabla."})]})]}),e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Tabla de Resultados:"}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"4px 0"},children:[e.jsx("li",{children:"Muestra lecturas que coinciden con filtros."}),e.jsx("li",{children:"Ordena haciendo clic en cabeceras."}),e.jsxs("li",{children:["Acciones: Marcar/desmarcar relevante (",e.jsx(ws,{size:"0.8rem"}),"), guardar vehículo para comprobaciones posteriores(",e.jsx(ss,{size:"0.8rem"}),")."]})]})]})]})]}),"busqueda-cruzada-lpr":e.jsxs(ie,{maw:400,children:[e.jsx(ne,{fw:500,mb:"sm",children:"Ayuda: Búsqueda Cruzada"}),e.jsxs(Te,{gap:"xs",children:[e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Propósito:"})," Identifica vehículos (matrículas) que aparecen en ",e.jsx("strong",{children:"múltiples conjuntos de filtros diferentes"})," dentro de este mismo caso. Es útil para encontrar vehículos vistos bajo distintas condiciones (p.ej., en dos zonas diferentes o en dos franjas horarias)."]}),e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Uso Correcto:"}),e.jsxs("ol",{style:{paddingLeft:"20px",margin:"4px 0"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Define y Guarda Búsquedas:"}),' Usa los filtros para definir un criterio (p.ej., Lector A entre 8:00-9:00). Haz clic en "Guardar Búsqueda" y dale un nombre descriptivo (p.ej., "Entrada Mañana"). Repite para otros criterios (p.ej., "Salida Tarde").']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Selecciona Búsquedas Guardadas:"})," Marca las casillas de las búsquedas guardadas que quieres cruzar (mínimo 2)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Realiza el Cruce:"}),' Haz clic en "Realizar Cruce".']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Resultados:"})," Se mostrará la lista de matrículas que aparecen en ",e.jsx("strong",{children:"todas"})," las búsquedas seleccionadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Ver Lecturas (Opcional):"})," Puedes seleccionar las matrículas resultantes para ver sus lecturas detalladas."]})]})]})]})]}),lanzadera:e.jsxs(ie,{maw:400,children:[e.jsx(ne,{fw:500,mb:"sm",children:"Ayuda: Vehículo Lanzadera"}),e.jsxs(Te,{gap:"xs",children:[e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Propósito:"}),' Detecta pares de vehículos que viajan juntos de forma consistente (convoyes), basándose en lecturas LPR cercanas en el tiempo y en múltiples ubicaciones o días distintos. Esto puede indicar un vehículo "lanzadera" que guía a otro.']}),e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Uso Correcto:"}),e.jsxs("ol",{style:{paddingLeft:"20px",margin:"4px 0"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Define Parámetros:"}),' Ajusta la "Ventana de Tiempo" (segundos máximos entre lecturas para considerarlas juntas) y las "Mínimas Coincidencias" (cuántas veces deben verse juntos en lectores o días distintos para ser significativo).']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Filtros Opcionales:"}),' Puedes filtrar por fecha/hora o centrarte en una "Matrícula Objetivo" específica.']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Detectar Convoy:"}),' Haz clic en "Detectar Convoy".']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Resultados:"}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"4px 0"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Lista de Vehículos:"})," Muestra todas las matrículas involucradas en algún convoy detectado. Puedes seleccionar vehículos para filtrar la tabla de detalles y el mapa."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tabla de Detalles:"})," Muestra cada instancia donde un par de vehículos seleccionados fueron vistos juntos (lector, hora, etc.)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mapa:"})," Visualiza geográficamente las ubicaciones de las co-ocurrencias de los vehículos seleccionados."]})]})]})]})]})]})]}),"lecturas-relevantes":e.jsxs(ie,{maw:400,children:[e.jsx(ne,{fw:500,mb:"sm",children:"Ayuda: Lecturas Relevantes"}),e.jsxs(Te,{gap:"xs",children:[e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Propósito:"})," Aquí se recopilan todas las lecturas que has marcado manualmente como importantes (",e.jsx(ws,{size:"0.8rem"}),') desde la pestaña "Lecturas LPR". Permite centrarse en los eventos clave de la investigación.']}),e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Funcionalidades:"}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"4px 0"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Visualización:"})," Muestra la tabla de lecturas marcadas. Puedes ordenar y paginar como en otras tablas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Notas:"})," Edita (",e.jsx(Ss,{size:"0.8rem"}),") o añade notas específicas a cada lectura relevante para recordar por qué es importante."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desmarcar:"})," Elimina (",e.jsx(ra,{size:"0.8rem"})," o ",e.jsx(ds,{size:"0.8rem"}),") la marca de relevancia si una lectura ya no es crucial. Puedes hacerlo individualmente o para una selección."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Guardar Vehículo:"})," Guarda rápidamente (",e.jsx(ss,{size:"0.8rem"}),") la matrícula de una lectura relevante como un vehículo para seguimiento posterior."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Selección Múltiple:"})," Usa las casillas para seleccionar varias lecturas y desmarcarlas o guardar sus vehículos en bloque."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Refrescar:"})," Actualiza (",e.jsx(Is,{size:"0.8rem"}),") la lista si has hecho cambios en otra pestaña."]})]})]})]})]}),vehiculos:e.jsxs(ie,{maw:400,children:[e.jsx(ne,{fw:500,mb:"sm",children:"Ayuda: Vehículos"}),e.jsxs(Te,{gap:"xs",children:[e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Propósito:"})," Gestiona la lista de vehículos (matrículas) asociados a este caso. Un vehículo se añade aquí automáticamente si aparece en las lecturas importadas o si lo guardas manualmente desde otras pestañas."]}),e.jsxs(ne,{size:"xs",children:[e.jsx("strong",{children:"Funcionalidades:"}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:"4px 0"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Listado:"})," Muestra todos los vehículos vinculados al caso, con detalles como marca, modelo, color, etc. (si se han añadido)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Lecturas LPR:"})," Indica cuántas lecturas LPR tiene cada vehículo *dentro de este caso*."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Editar Detalles:"})," Modifica (",e.jsx(Ss,{size:"0.8rem"}),") la información asociada a un vehículo (marca, modelo, propietario, observaciones, estado de comprobado/sospechoso)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Ver Lecturas:"})," Accede (",e.jsx(Ar,{size:"0.8rem"}),") a una vista filtrada de todas las lecturas (LPR y GPS) de un vehículo específico dentro de este caso."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Eliminar Vehículo:"})," Borra (",e.jsx(ds,{size:"0.8rem"}),") un vehículo de la lista del caso (Nota: Esto *no* elimina sus lecturas asociadas, solo el registro del vehículo)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Refrescar:"})," Actualiza (",e.jsx(Is,{size:"0.8rem"}),") la lista si se han hecho cambios (como guardar un vehículo desde otra pestaña)."]})]})]})]})]})};function mn(){const{idCaso:t}=Ra(),s=t?parseInt(t,10):null,[a,r]=p.useState(null),[o,i]=p.useState(!0),[l,u]=p.useState(null),[f,n]=p.useState([]),[m,v]=p.useState(!0),[y,x]=p.useState(null),[h,c]=p.useState(null),j=Pa(),[g,S]=p.useState("analisis-lpr"),[b,M]=p.useState(new Set),$=p.useCallback(R=>{M(K=>{const de=new Set(K);return R.forEach(pe=>de.add(pe)),de})},[]),[w,D]=p.useState([]),[E,k]=p.useState(!0),[F,T]=p.useState(1),H=15,[O,ee]=p.useState({columnAccessor:"Fecha_y_Hora",direction:"asc"}),[X,W]=p.useState([]),[N,q]=p.useState(null),[_,U]=p.useState(""),A=p.useCallback(async()=>{var R;if(s){k(!0);try{const K=await Ae.get(`/casos/${s}/lecturas_relevantes`);D(K.data||[]),console.log("[CasoDetailPage] Lecturas relevantes cargadas:",(R=K.data)==null?void 0:R.length)}catch(K){console.error("Error fetching relevant lecturas:",K),B.show({title:"Error",message:"No se pudieron cargar las lecturas relevantes.",color:"red"}),D([])}finally{k(!1)}}},[s]);p.useEffect(()=>{g==="lecturas-relevantes"&&A()},[s,g,A]);const V=R=>T(R),C=R=>ee(R),I=R=>W(R),se=R=>{var K;q(R),U(((K=R.relevancia)==null?void 0:K.Nota)||"")},oe=()=>{q(null),U("")},ue=async()=>{var K,de;if(!N||!N.relevancia)return;const R=N.relevancia.ID_Relevante;k(!0);try{await Ae.put(`/lecturas_relevantes/${R}/nota`,{Nota:_}),B.show({title:"Éxito",message:"Nota actualizada.",color:"green"}),oe(),A()}catch(pe){B.show({title:"Error",message:((de=(K=pe.response)==null?void 0:K.data)==null?void 0:de.detail)||"No se pudo guardar la nota.",color:"red"})}finally{k(!1)}},ce=R=>{ys({title:"Confirmar Desmarcar",centered:!0,children:e.jsxs(ne,{size:"sm",children:["¿Seguro que quieres desmarcar esta lectura (",R,") como relevante?"]}),labels:{confirm:"Desmarcar",cancel:"Cancelar"},confirmProps:{color:"red"},onConfirm:async()=>{var K,de;k(!0);try{await Ae.delete(`/lecturas/${R}/desmarcar_relevante`),B.show({title:"Éxito",message:`Lectura ${R} desmarcada.`,color:"green"}),A()}catch(pe){B.show({title:"Error",message:((de=(K=pe.response)==null?void 0:K.data)==null?void 0:de.detail)||"No se pudo desmarcar.",color:"red"})}finally{k(!1)}}})},te=()=>{const R=[...X];R.length!==0&&ys({title:"Confirmar Desmarcar Selección",centered:!0,children:e.jsxs(ne,{size:"sm",children:["¿Estás seguro de desmarcar ",R.length," lecturas seleccionadas?"]}),labels:{confirm:"Desmarcar Seleccionadas",cancel:"Cancelar"},confirmProps:{color:"red"},onConfirm:async()=>{k(!0);const K=await Promise.allSettled(R.map(Ne=>Ae.delete(`/lecturas/${Ne}/desmarcar_relevante`)));let de=0,pe=0;K.forEach((Ne,Re)=>{Ne.status==="fulfilled"?de++:(pe++,console.error(`Error desmarcando ID ${R[Re]}:`,Ne.reason))}),de>0&&B.show({title:"Desmarcado Completado",message:`${de} lecturas desmarcadas.`+(pe>0?` ${pe} fallaron.`:""),color:pe>0?"orange":"green"}),W([]),A(),k(!1)}})},ye=R=>{if(!R.Matricula){B.show({title:"Error",message:"La lectura no tiene matrícula.",color:"red"});return}ys({title:"Confirmar Guardar Vehículo",centered:!0,children:e.jsxs(ne,{size:"sm",children:["¿Guardar vehículo con matrícula ",R.Matricula,"?"]}),labels:{confirm:"Guardar",cancel:"Cancelar"},confirmProps:{color:"green"},onConfirm:async()=>{var K,de,pe,Ne;k(!0);try{await Ae.post("/vehiculos",{Matricula:R.Matricula}),B.show({title:"Éxito",message:`Vehículo ${R.Matricula} guardado.`,color:"green"}),hs.emit("listaVehiculosCambiada")}catch(Re){((K=Re.response)==null?void 0:K.status)===400||((de=Re.response)==null?void 0:de.status)===409?(B.show({title:"Vehículo Existente",message:`El vehículo ${R.Matricula} ya existe.`,color:"blue"}),hs.emit("listaVehiculosCambiada")):B.show({title:"Error",message:((Ne=(pe=Re.response)==null?void 0:pe.data)==null?void 0:Ne.detail)||"No se pudo guardar.",color:"red"})}finally{k(!1)}}})},Q=()=>{const R=w.filter(de=>X.includes(de.ID_Lectura)),K=Array.from(new Set(R.map(de=>de.Matricula).filter(de=>!!de)));if(K.length===0){B.show({title:"Sin Matrículas",message:"Ninguna lectura seleccionada tiene matrícula válida.",color:"orange"});return}ys({title:"Confirmar Guardar Vehículos",centered:!0,children:e.jsxs(ne,{size:"sm",children:["¿Guardar ",K.length," vehículo(s) único(s) (",K.join(", "),")?"]}),labels:{confirm:"Guardar Seleccionados",cancel:"Cancelar"},confirmProps:{color:"green"},onConfirm:async()=>{k(!0);const de=await Promise.allSettled(K.map(z=>Ae.post("/vehiculos",{Matricula:z})));let pe=0,Ne=0,Re=0;de.forEach(z=>{var G,he,Z,Y;z.status==="fulfilled"?pe++:((he=(G=z.reason)==null?void 0:G.response)==null?void 0:he.status)===400||((Y=(Z=z.reason)==null?void 0:Z.response)==null?void 0:Y.status)===409?Ne++:(Re++,console.error("Error guardando vehículo:",z.reason))});let d="";pe>0&&(d+=`${pe} guardados. `),Ne>0&&(d+=`${Ne} ya existían. `),Re>0&&(d+=`${Re} errores.`),B.show({title:"Guardar Vehículos Completado",message:d.trim(),color:Re>0?"orange":"green"}),hs.emit("listaVehiculosCambiada"),W([]),k(!1)}})},me=p.useCallback(async()=>{var R,K;if(!(!s||isNaN(s))){v(!0),x(null);try{const de=await Wa(s.toString());n(de)}catch(de){x(((K=(R=de.response)==null?void 0:R.data)==null?void 0:K.detail)||de.message||"Error al cargar los archivos.")}finally{v(!1)}}},[s]);p.useEffect(()=>{s&&!isNaN(s)?((async()=>{var K,de;i(!0),u(null);try{const pe=await Ga(s);r(pe)}catch(pe){u(((de=(K=pe.response)==null?void 0:K.data)==null?void 0:de.detail)||pe.message||"Error al cargar detalles del caso.")}finally{i(!1)}})(),me()):(r(null),n([]),u("No se proporcionó ID de caso."),x(null),i(!1),v(!1))},[s,me]);const re=async R=>{var K,de;if(window.confirm(`¿Seguro de eliminar archivo ID ${R} y sus lecturas?`)){c(R);try{await Ua(R),B.show({title:"Archivo Eliminado",message:`Archivo ${R} eliminado.`,color:"teal"}),await me()}catch(pe){B.show({title:"Error al Eliminar",message:((de=(K=pe.response)==null?void 0:K.data)==null?void 0:de.detail)||"No se pudo eliminar el archivo.",color:"red"})}finally{c(null)}}},[Se,ge]=p.useState([]),[je,P]=p.useState(!1),[le,J]=p.useState(null),fe=p.useCallback(async()=>{var R,K,de;if(s){console.log("[CasoMap] Fetching lecturas para mapa del caso:",s),P(!0),J(null);try{const pe=await Ae.get(`/casos/${s}/lecturas_para_mapa`);ge(pe.data||[]),console.log("[CasoMap] Lecturas cargadas:",(R=pe.data)==null?void 0:R.length)}catch(pe){console.error("Error fetching map lecturas:",pe),J(((de=(K=pe.response)==null?void 0:K.data)==null?void 0:de.detail)||"No se pudieron cargar los datos para el mapa."),ge([])}finally{P(!1)}}},[s]);p.useEffect(()=>{g==="mapa"&&Se.length===0&&!je&&fe()},[g,Se.length,fe]);const _e=[{accessor:"ID_Archivo",title:"ID",width:60,textAlign:"right"},{accessor:"Nombre_del_Archivo",title:"Nombre Archivo",render:R=>e.jsx(ne,{truncate:"end",children:R.Nombre_del_Archivo})},{accessor:"Tipo_de_Archivo",title:"Tipo",width:80},{accessor:"Fecha_de_Importacion",title:"Importado",render:R=>L(R.Fecha_de_Importacion).format("DD/MM/YYYY HH:mm"),width:150},{accessor:"Total_Registros",title:"Registros",width:100,textAlign:"right"},{accessor:"actions",title:"Acciones",width:80,textAlign:"center",render:R=>e.jsx($e,{label:"Eliminar Archivo",children:e.jsx(Le,{color:"red",variant:"subtle",onClick:()=>re(R.ID_Archivo),loading:h===R.ID_Archivo,children:e.jsx(ds,{size:16})})})}],De=p.useMemo(()=>N&&N.relevancia?{ID_Relevante:N.relevancia.ID_Relevante,Nota:N.relevancia.Nota}:null,[N,w]);if(o)return e.jsx(Ta,{});if(l)return e.jsx(ns,{color:"red",title:"Error al cargar el caso",children:l});if(!a)return e.jsx(ns,{color:"orange",children:"Caso no encontrado."});const ze=e.jsxs(it,{children:[e.jsx(wt,{component:bt,to:"/",children:"Dashboard"}),e.jsx(wt,{component:bt,to:"/casos",children:"Gestión de Casos"}),e.jsxs(ne,{children:[a.Nombre_del_Caso," (",a.Año,")"]})]});return e.jsxs(ar,{fluid:!0,children:[ze,e.jsxs(ne,{size:"xl",fw:700,mt:"md",mb:"lg",children:["Detalles del Caso: ",a.Nombre_del_Caso," (",a.Año,")"]}),e.jsx(we,{mb:"xl",children:Xo.map(R=>e.jsx(be,{variant:g===R.id?"filled":"light",onClick:()=>S(R.id),leftSection:e.jsx(R.icon,{size:16}),color:"gray",styles:K=>({root:{backgroundColor:g===R.id?K.colors[K.primaryColor][6]:void 0,color:g===R.id?K.white:void 0,"&:hover":{backgroundColor:g!==R.id?K.colors.gray[1]:void 0}},label:{fontWeight:g===R.id?600:400}}),children:R.label},R.id))}),e.jsxs(ie,{mt:"lg",style:{position:"relative"},children:[" ",e.jsxs(ie,{style:{display:g==="analisis-lpr"?"block":"none",position:"relative"},children:[e.jsx($e,{label:xs["analisis-lpr"],multiline:!0,withArrow:!0,position:"bottom-start",offset:8,styles:{tooltip:{maxWidth:"400px"}},zIndex:1001,children:e.jsx(Le,{variant:"subtle",color:"blue",size:"lg","aria-label":"Ayuda Lecturas LPR",style:{position:"absolute",top:"-35px",right:0,zIndex:10},children:e.jsx(gs,{size:"1.8rem",stroke:1.5})})}),e.jsx(Ba,{casoIdFijo:s,permitirSeleccionCaso:!1,mostrarTitulo:!1,tipoFuenteFijo:"LPR",interactedMatriculas:b,addInteractedMatricula:$})]}),e.jsxs(ie,{style:{display:g==="busqueda-cruzada-lpr"?"block":"none",position:"relative"},children:[e.jsx($e,{label:xs["busqueda-cruzada-lpr"],multiline:!0,withArrow:!0,position:"bottom-start",offset:8,styles:{tooltip:{maxWidth:"400px"}},zIndex:1001,children:e.jsx(Le,{variant:"subtle",color:"blue",size:"lg","aria-label":"Ayuda Búsqueda Cruzada",style:{position:"absolute",top:"-35px",right:0,zIndex:10},children:e.jsx(gs,{size:"1.8rem",stroke:1.5})})}),e.jsx(qo,{casoId:s,interactedMatriculas:b,addInteractedMatricula:$})]}),e.jsxs(ie,{style:{display:g==="lanzadera"?"block":"none",position:"relative"},children:[e.jsx($e,{label:xs.lanzadera,multiline:!0,withArrow:!0,position:"bottom-start",offset:8,styles:{tooltip:{maxWidth:"400px"}},zIndex:1001,children:e.jsx(Le,{variant:"subtle",color:"blue",size:"lg","aria-label":"Ayuda Vehículo Lanzadera",style:{position:"absolute",top:"-35px",right:0,zIndex:10},children:e.jsx(gs,{size:"1.8rem",stroke:1.5})})}),e.jsx(Zo,{casoId:s})]}),e.jsxs(ie,{style:{display:g==="lecturas-relevantes"?"block":"none",position:"relative"},children:[e.jsx($e,{label:xs["lecturas-relevantes"],multiline:!0,withArrow:!0,position:"bottom-start",offset:8,styles:{tooltip:{maxWidth:"400px"}},zIndex:1001,children:e.jsx(Le,{variant:"subtle",color:"blue",size:"lg","aria-label":"Ayuda Lecturas Relevantes",style:{position:"absolute",top:"-35px",right:0,zIndex:10},children:e.jsx(gs,{size:"1.8rem",stroke:1.5})})}),e.jsx(Go,{lecturas:w,loading:E,totalRecords:Array.isArray(w)?w.length:0,page:F,onPageChange:V,pageSize:H,sortStatus:O,onSortStatusChange:C,selectedRecordIds:X,onSelectionChange:I,onEditNota:se,onDesmarcar:ce,onDesmarcarSeleccionados:te,onGuardarVehiculo:ye,onGuardarVehiculosSeleccionados:Q,onRefresh:A})]}),e.jsxs(ie,{style:{display:g==="vehiculos"?"block":"none",position:"relative"},children:[e.jsx($e,{label:xs.vehiculos,multiline:!0,withArrow:!0,position:"bottom-start",offset:8,styles:{tooltip:{maxWidth:"400px"}},zIndex:1001,children:e.jsx(Le,{variant:"subtle",color:"blue",size:"lg","aria-label":"Ayuda Vehículos",style:{position:"absolute",top:"-35px",right:0,zIndex:10},children:e.jsx(gs,{size:"1.8rem",stroke:1.5})})}),e.jsx(Uo,{casoId:s})]}),e.jsx(ie,{style:{display:g==="mapa"?"block":"none",position:"relative"},children:e.jsxs(ie,{style:{position:"relative",height:"500px"},children:[e.jsx(Ke,{visible:je}),le&&e.jsx(ns,{color:"red",title:"Error en Mapa",children:le}),!je&&!le&&e.jsx(Or,{lectores:Se})]})}),e.jsxs(ie,{style:{display:g==="archivos"?"block":"none",position:"relative"},children:[e.jsxs(we,{justify:"space-between",mb:"md",children:[e.jsx(Ue,{order:4,children:"Archivos Importados"}),e.jsx(be,{leftSection:e.jsx(Fa,{size:16}),onClick:()=>j("/importar",{state:{preselectedCasoId:s}}),variant:"light",size:"sm",children:"Cargar Nuevos Archivos"})]}),e.jsx(Ke,{visible:m}),y&&e.jsx(ns,{color:"red",title:"Error",mb:"md",children:y}),e.jsx(cs,{records:f,columns:_e,minHeight:150,withTableBorder:!0,borderRadius:"sm",striped:!0,highlightOnHover:!0,idAccessor:"ID_Archivo",noRecordsText:"No hay archivos importados para este caso.",fetching:m})]})]}),e.jsx(Vr,{opened:!!N,onClose:oe,lecturaRelevante:De,onSave:async(R,K)=>{await ue()}})]})}export{mn as default};
